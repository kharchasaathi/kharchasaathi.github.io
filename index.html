<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ“¦ KharchaSaathi â€” Business Dashboard (Stable)</title>
  <meta name="theme-color" content="#ff7a00" />
  <link rel="icon" href="assets/favicon.png" />
  <!-- main style -->
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="topbar">
    <div class="top-left">
      <button id="backBtn" class="small-btn">ğŸ  Back</button>
      <h1>ğŸ“¦ KharchaSaathi</h1>
    </div>
    <div class="top-right">
      <button id="themeBtn" class="theme-btn">ğŸŒ™</button>
      <button id="helpBtn" class="small-btn">ğŸ“˜ Help</button>
    </div>
  </div>

  <nav class="tabs" role="tablist" aria-label="Main tabs">
    <div class="tab active" data-tab="dashboard">ğŸ“Š Overview</div>
    <div class="tab" data-tab="types">ğŸ—‚ Types</div>
    <div class="tab" data-tab="stock">ğŸ“¦ Stock</div>
    <div class="tab" data-tab="sales">ğŸ“ˆ Sales</div>
    <div class="tab" data-tab="wanting">ğŸ›’ Wanting</div>
    <div class="tab" data-tab="analytics">ğŸ“ˆ Smart Dashboard</div>
  </nav>

  <main id="mainContent">
    <!-- Sections are placeholders â€” content for each section will either be inline (small) or loaded by module files -->
    <section id="dashboard" class="section active" aria-labelledby="overviewTitle">
      <h2 id="overviewTitle">ğŸ“Š Business Overview</h2>
      <div id="summaryCards" class="summary-cards">
        <!-- cards filled by updateSummaryCards() -->
        <div class="card card-sales">
          <div class="card-emoji">ğŸ’°</div>
          <div class="card-value"><b id="todaySales">â‚¹0</b></div>
          <div class="card-label"><small>Today's Sales</small></div>
        </div>
        <div class="card card-credit">
          <div class="card-emoji">ğŸ’³</div>
          <div class="card-value"><b id="todayCredit">â‚¹0</b></div>
          <div class="card-label"><small>Today's Credit</small></div>
        </div>
        <div class="card card-stock">
          <div class="card-emoji">ğŸ“¦</div>
          <div class="card-value"><b id="stockRemain">0%</b></div>
          <div class="card-label"><small>Stock Remaining</small></div>
        </div>
        <div class="card card-profit">
          <div class="card-emoji">ğŸ“ˆ</div>
          <div class="card-value"><b id="todayProfit">â‚¹0</b></div>
          <div class="card-label"><small>Today's Profit</small></div>
        </div>
      </div>
      <!-- A compact area where analytics small preview can show (but full charts in analytics tab) -->
      <div id="analyticsPreview" class="analytics-preview" aria-hidden="true">
        <small>Smart Dashboard preview â€” click Smart Dashboard tab to open full charts</small>
      </div>
    </section>

    <section id="types" class="section" aria-hidden="true">
      <!-- simple placeholder: detailed UI loaded by types.js (Part2) -->
      <h2>ğŸ—‚ Types</h2>
      <div id="typesContainer">Loading types moduleâ€¦</div>
    </section>

    <section id="stock" class="section" aria-hidden="true">
      <h2>ğŸ“¦ Stock</h2>
      <div id="stockContainer">Loading stock moduleâ€¦</div>
    </section>

    <section id="sales" class="section" aria-hidden="true">
      <h2>ğŸ“ˆ Sales & Profit</h2>
      <div id="salesContainer">Loading sales moduleâ€¦</div>
    </section>

    <section id="wanting" class="section" aria-hidden="true">
      <h2>ğŸ›’ Wanting</h2>
      <div id="wantingContainer">Loading wanting moduleâ€¦</div>
    </section>

    <section id="analytics" class="section" aria-hidden="true">
      <h2>ğŸ“Š Smart Dashboard</h2>
      <div id="analyticsContainer">Loading analytics moduleâ€¦</div>
    </section>
  </main>

  <!-- Help modal (simple) -->
  <div id="helpModal" class="help-modal" aria-hidden="true">
    <div class="help-content">
      <h3>Quick Help</h3>
      <ul>
        <li>Manage Types, Stock, Sales and Wanting lists.</li>
        <li>Smart Dashboard uses your sales data to render charts (loads only when needed).</li>
      </ul>
      <button id="closeHelp" class="small-btn">Close</button>
    </div>
  </div>

  <!-- ===== Core Script (tabs + theme + safe init) ===== -->
<script src="js/core.js"></script>

<!-- ===== FINAL CLOSING / SAFETY SECTION ===== -->
<script>
(function(){
  console.log('%cğŸ§© Running Closing Safety Script...', 'color:#ff7a00;font-weight:bold;');

  // --- Auto-save on close (for all modules) ---
  window.addEventListener('beforeunload', function(){
    try {
      if (typeof window.saveAll === 'function') window.saveAll();
      if (typeof window.saveSales === 'function') window.saveSales();
      if (typeof window.saveWanting === 'function') window.saveWanting();
      console.log('%cğŸ’¾ All data saved before unload', 'color:#43a047;font-weight:bold;');
    } catch (e) {
      console.warn('âš ï¸ Auto-save failed:', e);
    }
  });

  // --- Pause heavy intervals when tab hidden, resume when visible ---
  document.addEventListener('visibilitychange', function(){
    if (document.hidden) {
      if (window.analyticsInterval) {
        clearInterval(window.analyticsInterval);
        console.log('â¸ Analytics paused');
      }
    } else {
      if (typeof window.ensureChartsLoadedAndRender === 'function') {
        window.ensureChartsLoadedAndRender();
        console.log('â–¶ï¸ Analytics resumed');
      }
    }
  });

  // --- Refresh summary when window refocuses ---
  window.addEventListener('focus', function(){
    try {
      if (typeof updateSummaryCards === 'function') {
        updateSummaryCards();
        console.log('ğŸ” Summary refreshed on focus');
      }
    } catch(e){}
  });

  console.log('%câœ… KharchaSaathi - Closing safety active','color:#4caf50;font-weight:bold;');
})();
<script>
  console.log('%câœ… KharchaSaathi - Closing safety active', 'color:#4caf50;font-weight:bold;');
})();
</script>

<!-- ===== SECURITY MODULE (Admin PIN & Protection) ===== -->
<script src="js/security.js"></script>

<!-- ===== FIREBASE CLOUD CONNECTION ===== -->
<script type="module" src="js/firebase.js"></script>

</body>
</html>

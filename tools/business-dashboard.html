7<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ“¦ KharchaSaathi â€” Business Dashboard (v1.2 Updated)</title>
  <meta name="theme-color" content="#ff7a00" />
  <link rel="icon" href="../favicon.png" />
  <link rel="apple-touch-icon" href="../favicon.png" />

  <style>
    :root{
      --orange:#ff7a00; --orange-dark:#cc6300;
      --bg:#f8f9fa; --card:#ffffff; --text:#222;
      --dark-bg:#0f0f0f; --dark-card:#1a1a1a; --dark-text:#f2f2f2; --dark-border:#333;
    }
    *{box-sizing:border-box;transition:background .18s,color .18s}
    html,body{height:100%}
    body{
      margin:0;padding:18px;font-family:Poppins,Arial,sans-serif;
      background:var(--bg);color:var(--text);
    }
    body.dark{background:var(--dark-bg);color:var(--dark-text)}

    /* Topbar */
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:12px}
    h1{margin:0;font-size:20px;color:var(--orange)}
    .theme-btn,.small-btn{background:var(--orange);color:#fff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
    .theme-btn:hover,.small-btn:hover{background:var(--orange-dark)}

    /* Tabs */
    .tabs{display:flex;gap:8px;margin:8px 0 16px;justify-content:center;flex-wrap:nowrap;overflow-x:auto}
    .tabs::-webkit-scrollbar{display:none}
    .tab{background:#eee;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;white-space:nowrap}
    .tab.active{background:var(--orange);color:#fff}
    body.dark .tab{background:#222;color:#ccc}
    body.dark .tab.active{background:var(--orange-dark);color:#fff}

    /* Sections */
    .section{display:none;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.05);margin-bottom:18px}
    .section.active{display:block}
    body.dark .section{background:var(--dark-card);border:1px solid var(--dark-border);color:var(--dark-text)}

    /* Summary + layout */
    .flex-row{display:flex;gap:18px;flex-wrap:wrap;align-items:flex-start}
    #overview-left{flex:1;min-width:280px}
    #overview-right{flex:1;min-width:320px;max-width:620px}

    #summaryCards{display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-start}
    #summaryCards .card{flex:1;min-width:140px;border-radius:12px;padding:12px;text-align:center;background:var(--card);box-shadow:0 6px 14px rgba(0,0,0,0.04)}
    #summaryCards .card small{font-size:13px;opacity:.85}
    body.dark #summaryCards .card{background:var(--dark-card);color:var(--dark-text);border:1px solid var(--dark-border)}

    /* Table */
    table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px;border-radius:8px;overflow:hidden}
    th,td{padding:8px;border:1px solid #ddd;text-align:center}
    th{background:var(--orange);color:#fff}
    body.dark th{background:var(--orange-dark)}
    tr:nth-child(even){background:#fdfdfd}
    body.dark tr:nth-child(even){background:#1f1f1f}
    tr:hover{background:#fff3e0}

    /* small forms */
    .row-inline{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .row-inline input[type="text"], .row-inline input[type="number"], .row-inline select, .row-inline input[type="date"]{padding:6px;border-radius:6px;border:1px solid #ddd}

    /* status */
    .ok{color:#43a047;font-weight:600}.low{color:#ffa726;font-weight:600}.out{color:#e53935;font-weight:700}

    /* help modal */
    .help-modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;z-index:1000}
    .help-content{background:var(--card);padding:22px;border-radius:12px;max-width:720px;width:92%}
    body.dark .help-content{background:var(--dark-card);color:var(--dark-text);border:1px solid var(--dark-border)}

    /* small responsive */
    @media (max-width:820px){
      #overview-right{order:2}
      #overview-left{order:1}
      .tab{padding:6px 10px}
    }
    .version-info{font-size:12px;text-align:center;opacity:.7;margin-top:6px}

    /* action buttons inside table */
    .action-btn{padding:6px 8px;border-radius:6px;border:none;background:#eee;cursor:pointer}
    .action-btn:hover{background:#ddd}

    /* Wanting inputs */
    .want-form { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; align-items:center; }
    .want-form input, .want-form select { padding:7px; border-radius:6px; border:1px solid #ddd; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1>ğŸ“¦ KharchaSaathi (Offline)</h1>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="themeBtn" class="theme-btn">ğŸŒ™</button>
      <a class="small-btn" href="../index.html">ğŸ  Back</a>
    </div>
  </div>

  <!-- NEW TAB ORDER: Types, Stock, Sales, Wanting, Overview, Smart dashboard -->
  <div class="tabs" role="tablist" aria-label="Main tabs">
    <div class="tab active" data-tab="types">ğŸ—‚ Types</div>
    <div class="tab" data-tab="stock">ğŸ“¦ Stock</div>
    <div class="tab" data-tab="sales">ğŸ“ˆ Sales</div>
    <div class="tab" data-tab="wanting">ğŸ›’ Wanting</div>
    <div class="tab" data-tab="dashboard">ğŸ“Š Overview</div>
    <div class="tab" data-tab="analytics">ğŸ“ˆ Smart Dashboard</div>
  </div>

  <!-- ===== TYPES ===== -->
  <section id="types" class="section active">
    <h3>ğŸ—‚ Manage Item Types</h3>
    <div class="row-inline" style="margin-top:8px">
      <input id="typeName" type="text" placeholder="Add new type (e.g. Mobiles)" style="flex:1;min-width:160px">
      <button id="addTypeBtn" class="small-btn">Add</button>
      <button id="clearTypesBtn" class="small-btn">Clear All</button>
    </div>
    <ul id="typeList" style="margin-top:10px;padding-left:18px"></ul>
  </section>

  <!-- ===== STOCK ===== -->
  <section id="stock" class="section">
    <h3>ğŸ“¦ Current Stock</h3>

    <div class="row-inline" style="margin-top:6px">
      <label>Low Stock Limit:</label>
      <input id="globalLimit" type="number" placeholder="e.g. 2" style="width:100px">
      <button id="setLimitBtn" class="small-btn">Set</button>
      <button id="clearStockBtn" class="small-btn">Clear All</button>
    </div>

    <div class="row-inline" style="margin-top:12px">
      <input id="pdate" type="date" style="min-width:140px">
      <select id="ptype" style="min-width:140px"></select>
      <input id="pname" type="text" placeholder="Product name" style="min-width:160px">
      <input id="pqty" type="number" placeholder="Qty" style="width:90px">
      <input id="pcost" type="number" placeholder="Cost â‚¹" style="width:100px">
      <button id="addStockBtn" class="small-btn">Add</button>
    </div>

    <div style="margin-top:12px">
      <label><b>Filter by Type:</b></label>
      <select id="filterType" style="min-width:160px">
        <option value="all">All Types</option>
      </select>
    </div>

    <table id="stockTable" aria-label="Stock table">
      <thead>
        <tr><th>Date</th><th>Type</th><th>Product</th><th>Qty</th><th>Sold</th><th>Remain</th><th>Alert</th><th>Limit</th><th>Action</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ===== SALES ===== -->
  <section id="sales" class="section">
    <h3>ğŸ’° Sales & Profit</h3>

    <div class="row-inline" style="margin-top:8px;margin-bottom:8px">
      <label>Sale Date:</label>
      <input id="saleDate" type="date" style="min-width:150px">
      <label>Type</label>
      <select id="saleType" style="min-width:140px"></select>
      <label>Product</label>
      <select id="saleProduct" style="min-width:180px"></select>
      <input id="saleQty" type="number" placeholder="Qty" style="width:80px">
      <input id="salePrice" type="number" placeholder="Sale â‚¹" style="width:100px">
      <select id="saleStatus" style="min-width:100px"><option value="Paid">Paid</option><option value="Credit">Credit</option></select>
      <button id="addSaleBtn" class="small-btn">Add Sale</button>
    </div>

    <div class="row-inline" style="margin-bottom:8px;align-items:center">
      <label>GST?</label>
      <input id="includeGst" type="checkbox"><input id="gstPercent" type="number" placeholder="GST %" style="width:80px" value="0">
      <button id="viewSalesBtn" class="small-btn">View by Date</button>
      <button id="printSalesBtn" class="small-btn">Print</button>

      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <button id="toggleProfitBtn" class="small-btn">ğŸ”’ Lock/Unlock Profit</button>
        <button id="setAdminBtn" class="small-btn">Set Admin PW</button>
      </div>
    </div>

    <table id="salesTable" aria-label="Sales table">
      <thead><tr><th>Date</th><th>Type</th><th>Product</th><th>Qty</th><th>Price â‚¹</th><th>Total â‚¹</th><th>Profit â‚¹</th><th>Status</th></tr></thead>
      <tbody></tbody>
      <tfoot><tr><td colspan="5" style="text-align:right">Total:</td><td id="salesTotal">0</td><td id="profitTotal">0</td><td></td></tr></tfoot>
    </table>
  </section>

  <!-- ===== WANTING ===== -->
  <section id="wanting" class="section">
    <h3>ğŸ›’ Wanting List</h3>

    <!-- Full UI for Wanting (type select, name, note) -->
    <div class="want-form">
      <select id="wantType" style="min-width:160px">
        <option value="">Select Type</option>
      </select>
      <input id="wantName" type="text" placeholder="Product name" style="min-width:200px">
      <input id="wantNote" type="text" placeholder="Note (optional)" style="min-width:200px">
      <button id="addWantBtn" class="small-btn">â• Add Item</button>
      <button id="clearWantBtn" class="small-btn">ğŸ—‘ Clear All</button>
      <button id="printWantBtn" class="small-btn">ğŸ–¨ Print</button>
    </div>

    <table id="wantingTable" style="width:100%;border-collapse:collapse;">
      <thead>
        <tr><th>Date</th><th>Type</th><th>Product</th><th>Note</th><th>Action</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ===== OVERVIEW ===== -->
  <section id="dashboard" class="section">
    <h3>ğŸ“Š Business Overview</h3>
    <div class="flex-row" id="overview-row">
      <div id="overview-left">
        <div id="summaryCards" aria-live="polite">
          <div class="card">
            <div style="font-size:20px">ğŸ’°</div>
            <b id="todaySales">â‚¹0</b><br><small>Today's Sales</small>
          </div>
          <div class="card">
            <div style="font-size:20px">ğŸ’³</div>
            <b id="todayCredit">â‚¹0</b><br><small>Today's Credit</small>
          </div>
          <div class="card">
            <div style="font-size:20px">ğŸ“¦</div>
            <b id="stockRemain">0%</b><br><small>Stock Remaining</small>
          </div>
          <div class="card">
            <div style="font-size:20px">ğŸ“ˆ</div>
            <b id="todayProfit">â‚¹0</b><br><small>Today's Profit</small>
          </div>
        </div>
      </div>

      <div id="overview-right">
        <div style="display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap">
          <div style="flex:1;min-width:140px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.05)">
            <div style="font-size:14px;font-weight:600">Quick</div>
            <div id="quickInfo" style="margin-top:6px;opacity:.85">No data yet</div>
          </div>
          <div style="flex:1;min-width:140px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.05)">
            <div style="font-size:14px;font-weight:600">Status</div>
            <div id="quickStatus" style="margin-top:6px;opacity:.85">Idle</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== SMART DASHBOARD / ANALYTICS ===== -->
  <section id="analytics" class="section">
    <h3>ğŸ“Š Smart Sales Dashboard</h3>
    <div style="display:flex;flex-wrap:wrap;gap:20px;justify-content:flex-end;align-items:center">
      <div style="flex:1;min-width:320px;max-width:520px"><canvas id="salesBar" height="220"></canvas></div>
      <div style="flex:1;min-width:240px;max-width:360px"><canvas id="salesPie" height="220"></canvas></div>
    </div>
    <p style="text-align:center;margin-top:12px;opacity:.75;font-size:13px">ğŸ”„ Auto-updates every 60s</p>
  </section>

  <!-- HELP -->
  <div class="footer-btns" style="margin-top:18px">
    <a href="#" id="helpLink" class="small-btn">ğŸ“˜ Help & Guide</a>
    <div class="version-info">v1.2 â€” updated 700-line model</div>
  </div>

  <div id="helpModal" class="help-modal" role="dialog" aria-hidden="true">
    <div class="help-content">
      <h2>ğŸ“˜ Quick Help</h2>
      <ul style="line-height:1.6">
        <li>Types â†’ add and manage item categories</li>
        <li>Stock â†’ add stock, set low limits, quick actions</li>
        <li>Sales â†’ record Paid / Credit sales, print & filter</li>
        <li>Wanting â†’ add reorder items manually or auto-add when stock ends</li>
        <li>Smart Dashboard â†’ charts auto-update</li>
      </ul>
      <div style="text-align:right;margin-top:12px"><button class="small-btn" onclick="toggleHelp()">Close</button></div>
    </div>
  </div>

  <!-- SCRIPTS: minimal UI glue + module includes (order matters) -->
  <script>
    // minimal helpers
    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));
    function toggleHelp(){ const m = qs('#helpModal'); m.style.display = (m.style.display==='flex'?'none':'flex'); }
    qs('#helpLink').addEventListener('click', e=>{ e.preventDefault(); toggleHelp(); });

    // theme toggle (keeps CSS rules already defined)
    (function(){
      if(localStorage.getItem('ks-theme') === 'dark') document.body.classList.add('dark');
      qs('#themeBtn').addEventListener('click', ()=>{
        const isDark = document.body.classList.toggle('dark');
        localStorage.setItem('ks-theme', isDark ? 'dark' : 'light');
      });
    })();

    // Tabs switching (custom order as requested)
    (function(){
      const tabs = qsa('.tab'), sections = qsa('.section');
      function activate(name){
        tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab===name));
        sections.forEach(s=>s.classList.toggle('active', s.id===name));
        // call some on-demand renders if functions available
        if(name==='types' && typeof renderTypes==='function'){ renderTypes(); if(typeof updateDropdowns==='function') updateDropdowns(); }
        if(name==='stock' && typeof renderStock==='function'){ renderStock(); if(typeof patchStockActions==='function') patchStockActions(); }
        if(name==='sales' && typeof initSalesModule==='function'){ initSalesModule(); }
        if(name==='wanting' && typeof renderWanting==='function'){ renderWanting(); if(typeof updateTypeDropdowns==='function') updateTypeDropdowns(); }
        if(name==='dashboard' && typeof updateSummaryCards==='function'){ updateSummaryCards(); }
        if(name==='analytics' && typeof ensureChartsLoadedAndRender==='function'){ ensureChartsLoadedAndRender(); }
      }
      tabs.forEach(t=> t.addEventListener('click', ()=> activate(t.dataset.tab)));
      // expose
      window.activateTab = activate;
    })();
  </script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Firebase Compat Libraries -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<!-- Your Firebase file -->
<script src="../js/firebase.js"></script>

<!-- Project Modules -->
<script src="../js/core.js"></script>
<script src="../js/types.js"></script>
<script src="../js/stock.js"></script>
<script src="../js/sales.js"></script>
<script src="../js/wanting.js"></script>
<script src="../js/analytics.js"></script>
<script src="../js/security.js"></script>
</body>
</html>

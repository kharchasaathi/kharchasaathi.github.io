<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ“¦ KharchaSaathi â€” Business Dashboard (Stable)</title>
<meta name="theme-color" content="#ff7a00">
<style>
:root{
  --orange:#ff7a00;--orange-dark:#cc6300;
  --bg:#f8f9fa;--card:#fff;--text:#222;
  --dark-bg:#0f0f0f;--dark-card:#1b1b1b;--dark-text:#f2f2f2;
  --dark-border:#444;
}
*{box-sizing:border-box;transition:background .2s,color .2s}
body{
  font-family:Poppins,Arial,sans-serif;margin:0;padding:18px;
  background:var(--bg);color:var(--text);
}
body.dark{background:var(--dark-bg);color:var(--dark-text)}
h1{color:var(--orange);margin:0;font-size:20px}
.topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:14px}
.theme-btn,.small-btn{
  background:var(--orange);color:#fff;border:none;
  padding:8px 10px;border-radius:8px;cursor:pointer;transition:.15s;
}
.theme-btn:hover,.small-btn:hover{background:var(--orange-dark)}
.tabs{display:flex;gap:8px;margin:6px 0 18px;justify-content:center;flex-wrap:wrap}
.tab{background:#eee;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
body.dark .tab{background:#222;color:#ccc}
.tab.active{background:var(--orange);color:#fff}
.section{display:none;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.06);margin-bottom:18px}
.section.active{display:block}
body.dark .section{background:var(--dark-card);border:1px solid var(--dark-border);color:var(--dark-text)}
.footer-btns{text-align:center;margin-top:20px}
.footer-btns a{background:var(--orange);color:#fff;padding:10px 16px;border-radius:8px;text-decoration:none;margin:6px;display:inline-block}
.footer-btns a:hover{background:var(--orange-dark)}
.help-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;z-index:1000}
.help-content{background:var(--card);padding:20px;max-width:640px;border-radius:12px;color:var(--text);overflow-y:auto;max-height:85vh}
body.dark .help-content{background:var(--dark-card);color:var(--dark-text)}
</style>
</head>

<body>
<div class="topbar">
  <h1>ğŸ“¦ KharchaSaathi (Offline)</h1>
  <div style="display:flex;gap:8px;align-items:center">
    <button class="theme-btn" id="themeBtn">ğŸŒ™</button>
    <a class="small-btn" href="../index.html">ğŸ  Back</a>
  </div>
</div>

<div class="tabs" role="tablist">
  <div class="tab active" data-tab="types">ğŸ—‚ Types</div>
  <div class="tab" data-tab="stock">ğŸ“¦ Stock</div>
  <div class="tab" data-tab="sales">ğŸ“ˆ Sales</div>
  <div class="tab" data-tab="wanting">ğŸ›’ Wanting</div>
</div>

<!-- Sections injected below -->
<section id="types" class="section active"></section>
<section id="stock" class="section"></section>
<section id="sales" class="section"></section>
<section id="wanting" class="section"></section>

<div class="footer-btns">
  <a href="#" id="helpLink">ğŸ“˜ Help & Guide</a>
</div>

<!-- Help Modal -->
<div id="helpModal" class="help-modal">
  <div class="help-content">
    <h2>ğŸ“˜ Quick Help</h2>
    <ul style="padding-left:18px;line-height:1.6">
      <li>ğŸ—‚ Manage item <b>Types</b></li>
      <li>ğŸ“¦ Add stock & track history</li>
      <li>ğŸ’° Record Sales (Cash/Credit)</li>
      <li>ğŸ›’ Auto Wanting alerts</li>
      <li>â˜ï¸ Data saved offline</li>
    </ul>
    <button class="small-btn" onclick="toggleHelp()">Close</button>
  </div>
</div>

<script>
/* ğŸŒ™ Theme Toggle */
(function(){
  if(localStorage.getItem('ks-theme')==='dark')document.body.classList.add('dark');
  document.getElementById('themeBtn').onclick=()=>{
    document.body.classList.toggle('dark');
    localStorage.setItem('ks-theme',document.body.classList.contains('dark')?'dark':'light');
  };
})();

/* ğŸ—‚ Tabs Handling */
(function(){
  const tabs=document.querySelectorAll('.tab');
  const sections=document.querySelectorAll('.section');
  function activate(tab){
    tabs.forEach(t=>t.classList.remove('active'));
    sections.forEach(s=>s.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab)?.classList.add('active');
  }
  tabs.forEach(tab=>{
    tab.addEventListener('click',()=>activate(tab));
  });
})();

/* ğŸ“˜ Help Modal */
function toggleHelp(){
  const m=document.getElementById('helpModal');
  m.style.display=m.style.display==='flex'?'none':'flex';
}
document.getElementById('helpLink').onclick=e=>{e.preventDefault();toggleHelp();};
</script>
  <!-- âœ… PART 2 : TYPES + STOCK ENHANCED -->
<section id="types" class="section active">
  <h3>ğŸ—‚ Manage Item Types</h3>
  <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
    <input type="text" id="typeName" placeholder="Add new type" style="flex:1;min-width:180px">
    <button id="addTypeBtn">Add</button>
    <button class="small-btn" id="clearTypesBtn">Clear All</button>
  </div>
  <ul id="typeList" style="margin-top:10px;padding-left:18px"></ul>
</section>

<section id="stock" class="section">
  <h3>ğŸ“¦ Current Stock</h3>
  <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
    <label>Low Stock Limit:</label>
    <input type="number" id="globalLimit" placeholder="e.g.2" style="width:100px">
    <button class="small-btn" id="setLimitBtn">Set</button>
    <button class="small-btn" id="clearStockBtn">Clear All</button>
  </div>

  <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
    <input type="date" id="pdate" style="min-width:150px">
    <select id="ptype" style="min-width:140px"></select>
    <input type="text" id="pname" placeholder="Product name" style="min-width:160px">
    <input type="number" id="pqty" placeholder="Qty" style="width:80px">
    <input type="number" id="pcost" placeholder="Cost â‚¹" style="width:100px">
    <button id="addStockBtn">Add</button>
  </div>

  <div style="margin-top:12px">
    <label><b>Filter by Type:</b></label>
    <select id="filterType" style="min-width:160px"><option value="all">All Types</option></select>
  </div>

  <table id="stockTable">
    <thead>
      <tr><th>Date</th><th>Type</th><th>Product</th><th>Qty</th><th>Sold</th><th>Remain</th><th>Alert</th><th>Limit</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
const K_TYPES='item-types',K_STOCK='stock-data',K_LIMIT='default-limit';
window.types=JSON.parse(localStorage.getItem(K_TYPES)||'[]');
window.stock=JSON.parse(localStorage.getItem(K_STOCK)||'[]');

/* Save */
function saveAllLocal(){
  localStorage.setItem(K_TYPES,JSON.stringify(types));
  localStorage.setItem(K_STOCK,JSON.stringify(stock));
}

/* Render types */
function renderTypes(){
  const list=document.getElementById('typeList');
  list.innerHTML=types.length?types.map(t=>`<li>${t}</li>`).join(''):'<li>No types yet</li>';
}

/* Dropdown update */
function updateDropdowns(){
  ['ptype','filterType'].forEach(id=>{
    const el=document.getElementById(id);
    if(!el)return;
    const base=id==='filterType'?'<option value="all">All Types</option>':'<option value="">Select</option>';
    el.innerHTML=base+types.map(t=>`<option value="${t}">${t}</option>`).join('');
  });
}

/* Add type */
function addType(){
  const t=typeName.value.trim();
  if(!t)return alert('Enter type name');
  if(types.includes(t))return alert('Type exists');
  types.push(t);saveAllLocal();renderTypes();updateDropdowns();typeName.value='';
}

/* Clear types */
function clearTypes(){if(confirm('Clear all types?')){types=[];saveAllLocal();renderTypes();updateDropdowns();}}

/* Limit */
function setGlobalLimit(){
  const v=parseInt(globalLimit.value);
  if(isNaN(v)||v<0)return alert('Invalid');
  localStorage.setItem(K_LIMIT,v);alert('Limit set '+v);
}
function getLimit(){const v=parseInt(localStorage.getItem(K_LIMIT));return isNaN(v)?0:v;}

/* Add stock */
function addStock(){
  const d=pdate.value,t=ptype.value,n=pname.value.trim(),q=parseInt(pqty.value),c=parseFloat(pcost.value);
  if(!d||!t||!n||!q||!c)return alert('Fill all');
  let ex=stock.find(s=>s.type===t&&s.name.toLowerCase()===n.toLowerCase());
  if(ex){ex.qty+=q;ex.date=d;ex.cost=c;ex.history=ex.history||[];ex.history.push({date:d,qty:q,cost:c});}
  else stock.push({date:d,type:t,name:n,qty:q,sold:0,cost:c,history:[{date:d,qty:q,cost:c}]});
  saveAllLocal();renderStock();pname.value='';pqty.value='';pcost.value='';
}

/* Clear stock */
function clearStock(){if(confirm('Clear all stock?')){stock=[];saveAllLocal();renderStock();}}

/* Render stock */
function renderStock(){
  const f=filterType.value,tb=document.querySelector('#stockTable tbody');
  tb.innerHTML=stock.filter(s=>f==='all'||s.type===f).map((s,i)=>{
    const sold=s.sold||0,rem=s.qty-sold,lim=getLimit();let cls='ok',msg='OK';
    if(rem<=0){cls='out';msg='OUT'}else if(rem<=lim){cls='low';msg='LOW'}
    return `<tr><td>${s.date}</td><td>${s.type}</td><td>${s.name}</td><td>${s.qty}</td><td>${sold}</td><td>${rem}</td><td class="${cls}">${msg}</td><td>${lim}</td><td><button onclick="viewHistory(${i})">ğŸ“œ</button></td></tr>`;
  }).join('')||'<tr><td colspan="9">No data</td></tr>';
}

/* View history */
function viewHistory(i){
  const s=stock[i];
  if(!s.history?.length)return alert('No history');
  const hist=s.history.map(h=>`${h.date} â†’ Qty:${h.qty} @â‚¹${h.cost}`).join('\n');
  alert(`ğŸ“œ ${s.name} History:\n${hist}`);
}

/* Events */
document.addEventListener('click',e=>{
  if(e.target.id==='addTypeBtn')addType();
  if(e.target.id==='clearTypesBtn')clearTypes();
  if(e.target.id==='setLimitBtn')setGlobalLimit();
  if(e.target.id==='clearStockBtn')clearStock();
  if(e.target.id==='addStockBtn')addStock();
});
filterType?.addEventListener('change',renderStock);
window.addEventListener('load',()=>{renderTypes();updateDropdowns();renderStock();});
</script>
  <!-- ğŸŸ§ Final Safe Closing (for Business Dashboard) -->
<style>
  /* Simple color highlights for alerts */
  .ok { color: green; font-weight: 600; }
  .low { color: orange; font-weight: 600; }
  .out { color: red; font-weight: 700; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 6px 8px;
    text-align: center;
  }
  th {
    background: var(--orange);
    color: #fff;
  }
  body.dark th {
    background: var(--orange-dark);
  }
</style>

<!-- âœ… Initialize everything on load -->
<script>
window.addEventListener("load",()=>{
  // If first time user has no data, preload basic example
  if(!localStorage.getItem('item-types')){
    localStorage.setItem('item-types',JSON.stringify(['Example Type']));
  }
  if(!localStorage.getItem('stock-data')){
    localStorage.setItem('stock-data',JSON.stringify([]));
  }
  console.log("âœ… KharchaSaathi loaded successfully!");
});
</script>

</body>
</html>

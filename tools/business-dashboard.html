<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KharchaSaathi ¬∑ Business OS</title>
  <meta name="theme-color" content="#0b2b4a" />
  
  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz@14..32&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    /* === PROFESSIONAL MODERN STYLES (RETAINING ALL OLD IDs/CLASSES) === */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #0b2b4a;
      --primary-light: #1e3a5f;
      --primary-soft: #eef2f8;
      --accent: #2b6c94;
      --accent-light: #4a8bb7;
      --success: #1e7e5a;
      --success-light: #e0f2e9;
      --warning: #b15e1a;
      --warning-light: #fff0e0;
      --danger: #b13e3e;
      --danger-light: #fee9e9;
      --neutral-50: #f8fafc;
      --neutral-100: #f1f4f9;
      --neutral-200: #e2e8f0;
      --neutral-300: #cbd5e1;
      --neutral-600: #475569;
      --neutral-800: #1e293b;
      --white: #ffffff;
      --shadow-sm: 0 2px 8px rgba(0,20,40,0.06);
      --shadow-md: 0 4px 16px rgba(0,20,40,0.08);
      --shadow-lg: 0 8px 28px rgba(0,20,40,0.12);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--neutral-100);
      color: var(--neutral-800);
      line-height: 1.5;
      min-height: 100vh;
    }

    /* Modern App Bar (replaces .topbar) */
    .topbar {
      background: var(--white);
      border-bottom: 1px solid var(--neutral-200);
      padding: 0.75rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,0.95);
      box-shadow: var(--shadow-sm);
    }

    .topbar h1 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .topbar-logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(11,43,74,0.25);
    }

    .topbar-logo span {
      font-size: 1.5rem;
      color: white;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 1.25rem;
    }

    #emailTag {
      background: var(--primary-soft);
      padding: 0.5rem 1rem;
      border-radius: 100px;
      font-size: 0.875rem;
      color: var(--primary);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .simple-clock {
      background: var(--white);
      border: 1px solid var(--neutral-200);
      padding: 0.4rem 1rem;
      border-radius: 100px;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .clock-line {
      font-weight: 600;
      color: var(--primary);
    }

    .clock-line.small {
      color: var(--neutral-600);
      font-size: 0.75rem;
    }

    .theme-btn, .small-btn {
      background: transparent;
      border: 1px solid var(--neutral-200);
      color: var(--neutral-600);
      padding: 0.6rem 1.25rem;
      border-radius: 10px;
      font-weight: 500;
      font-size: 0.875rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }

    .theme-btn:hover, .small-btn:hover {
      background: var(--neutral-100);
      border-color: var(--neutral-300);
      color: var(--primary);
    }

    #logoutBtn {
      background: var(--danger);
      color: white;
      border: none;
    }

    #logoutBtn:hover {
      background: #9f3a3a;
    }

    /* KPI Cards (replaces #universalBar) */
    #universalBar {
      background: var(--white);
      border-bottom: 1px solid var(--neutral-200);
    }

    .uni-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.25rem;
      padding: 1.5rem 2rem;
      max-width: 1600px;
      margin: 0 auto;
    }

    .uni-card {
      background: var(--white);
      border: 1px solid var(--neutral-200);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      position: relative;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
    }

    .uni-card:hover {
      box-shadow: var(--shadow-md);
      border-color: var(--accent-light);
    }

    .uni-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--neutral-600);
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .uni-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--primary);
      line-height: 1.2;
    }

    .uni-sub {
      margin-top: 0.75rem;
      display: flex;
      gap: 1rem;
      font-size: 0.75rem;
      color: var(--neutral-600);
    }

    .uni-sub span {
      font-weight: 600;
      color: var(--neutral-800);
    }

    .collect-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: var(--success-light);
      color: var(--success);
      border: none;
      padding: 0.25rem 0.75rem;
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .collect-btn:hover {
      background: var(--success);
      color: white;
    }

    /* Navigation Tabs */
    .tabs {
      background: var(--white);
      padding: 0.5rem 2rem;
      border-bottom: 1px solid var(--neutral-200);
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .tab {
      padding: 0.6rem 1.25rem;
      border-radius: 30px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--neutral-600);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .tab:hover {
      background: var(--neutral-100);
      color: var(--primary);
    }

    .tab.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(11,43,74,0.25);
    }

    /* Sections */
    .section {
      display: none;
      padding: 2rem;
      max-width: 1600px;
      margin: 0 auto;
      animation: fadeIn 0.3s ease;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h3 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    /* Form rows */
    .row-inline {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
      background: var(--white);
      padding: 1.25rem;
      border-radius: var(--radius-lg);
      border: 1px solid var(--neutral-200);
      margin-bottom: 1.5rem;
    }

    input, select, button {
      font-family: inherit;
    }

    input, select {
      padding: 0.6rem 1rem;
      border: 1px solid var(--neutral-200);
      border-radius: 10px;
      font-size: 0.875rem;
      background: var(--white);
      min-width: 140px;
      transition: all 0.2s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(43,108,148,0.1);
    }

    select {
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23475569' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      appearance: none;
      padding-right: 2.5rem;
    }

    button.small-btn {
      background: var(--white);
      border: 1px solid var(--neutral-200);
      color: var(--neutral-600);
      padding: 0.6rem 1.25rem;
      border-radius: 10px;
      font-weight: 500;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    button.small-btn:hover {
      background: var(--neutral-100);
      border-color: var(--neutral-300);
      color: var(--primary);
    }

    /* Special buttons */
    #clearStockBtn, #clearSalesBtn, #clearWantBtn, #clearServiceBtn, #clearExpensesBtn, #clearCollectionBtn {
      background: var(--danger-light);
      color: var(--danger);
      border-color: #fecaca;
    }

    #clearStockBtn:hover, #clearSalesBtn:hover, #clearWantBtn:hover, #clearServiceBtn:hover, #clearExpensesBtn:hover, #clearCollectionBtn:hover {
      background: #fecaca;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--white);
      border-radius: var(--radius-lg);
      border: 1px solid var(--neutral-200);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      margin-top: 1rem;
    }

    th {
      text-align: left;
      padding: 1rem 1.25rem;
      background: var(--neutral-50);
      color: var(--neutral-600);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid var(--neutral-200);
    }

    td {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--neutral-200);
      color: var(--neutral-800);
    }

    tfoot td {
      background: var(--neutral-50);
      font-weight: 600;
      border-top: 2px solid var(--neutral-200);
    }

    /* Stock investment box */
    #stockInvBox {
      background: #fefce8;
      border: 1px solid #facc15;
      border-radius: var(--radius-lg);
      padding: 1rem;
      max-width: 300px;
      margin-left: auto;
      font-weight: 600;
      font-size: 0.875rem;
      box-shadow: var(--shadow-sm);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .topbar {
        padding: 0.75rem 1rem;
        flex-direction: column;
        gap: 0.75rem;
      }
      .uni-row {
        padding: 1rem;
      }
      .section {
        padding: 1rem;
      }
      .row-inline {
        flex-direction: column;
        align-items: stretch;
      }
      .topbar-right {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
<script>
  const qs = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
</script>

<!-- ==================== TOP BAR ==================== -->
<div class="topbar">
  <h1>
    <div class="topbar-logo"><span>‚Çπ</span></div>
    KHARCHASAATHI
  </h1>
  <div class="topbar-right">
    <span id="emailTag">Checking login‚Ä¶</span>
    <div class="simple-clock">
      <span id="clockTime" class="clock-line">--:--:--</span>
      <span id="clockDate" class="clock-line small">--</span>
    </div>
    <button id="themeBtn" class="theme-btn" title="Theme (disabled)">üé®</button>
    <a class="small-btn" href="/index.html">üè† Home</a>
    <button id="logoutBtn" class="small-btn">üîì Logout</button>
  </div>
</div>

<!-- ==================== UNIVERSAL BAR (KPI CARDS) ==================== -->
<div id="universalBar">
  <div class="uni-row">
    <div class="uni-card main">
      <button class="collect-btn" data-collect="net">‚Çπ Collect</button>
      <div class="uni-title">Net Profit (Sale + Service ‚àí Expenses)</div>
      <div class="uni-value" id="unNetProfit">‚Çπ0</div>
      <div class="uni-sub">
        <span>Sale:</span><span id="unSaleProfit">‚Çπ0</span>
        <span>Service:</span><span id="unServiceProfit">‚Çπ0</span>
        <span class="uni-exp-label">Exp:</span>
        <span id="unExpenses" class="uni-exp-value">‚Çπ0</span>
      </div>
    </div>
    <div class="uni-card">
      <button class="collect-btn" data-collect="stock">‚Çπ Collect</button>
      <div class="uni-title">Stock Investment (Sold Items)</div>
      <div class="uni-value small" id="unStockInv">‚Çπ0</div>
      <div class="uni-sub">
        <span class="uni-chip">Sold stock</span>
      </div>
    </div>
    <div class="uni-card">
      <button class="collect-btn" data-collect="service">‚Çπ Collect</button>
      <div class="uni-title">Service Investment (Completed)</div>
      <div class="uni-value small" id="unServiceInv">‚Çπ0</div>
      <div class="uni-sub">
        <span class="uni-chip">Closed jobs</span>
      </div>
    </div>
    <div class="uni-card">
      <div class="uni-title">Pending Credit Sales</div>
      <div class="uni-value small" id="unCreditSales">‚Çπ0</div>
      <div class="uni-sub">
        <span class="uni-chip">To be collected</span>
      </div>
    </div>
  </div>
</div>

<!-- ==================== TAB SUMMARY (optional, kept for compatibility) ==================== -->
<div id="tabSummaryBar">Profit: +‚Çπ0</div>

<!-- ==================== NAVIGATION TABS ==================== -->
<div class="tabs" role="tablist">
  <div class="tab active" data-tab="types">üìÅ Types</div>
  <div class="tab" data-tab="stock">üì¶ Stock</div>
  <div class="tab" data-tab="sales">üìà Sales</div>
  <div class="tab" data-tab="wanting">üõí Wanting</div>
  <div class="tab" data-tab="service">üõ† Service</div>
  <div class="tab" data-tab="expenses">üí∏ Expenses</div>
  <div class="tab" data-tab="dashboard">üìä Dashboard</div>
  <div class="tab" data-tab="collection">ü™ô Collection</div>
</div>
<!-- Extra reset tab (as in original) -->
<div class="tab" data-tab="reset">üß® Reset</div>

<!-- ==================== TYPES SECTION ==================== -->
<section id="types" class="section active">
  <h3>üóÇ Manage Item Types</h3>
  <div class="row-inline" style="margin-top:8px;">
    <input id="typeName" type="text" placeholder="Add new type" style="flex:1;">
    <button id="addTypeBtn" class="small-btn">Add</button>
    <button id="clearTypesBtn" class="small-btn">Clear All</button>
    <button id="syncTypesBtn" class="small-btn" title="Save types to cloud">‚òÅÔ∏è Sync</button>
  </div>
  <ul id="typeList" style="margin-top:10px; padding-left:18px; font-size:13px;"></ul>
</section>

<!-- ==================== STOCK SECTION ==================== -->
<section id="stock" class="section">
  <h3>üì¶ Current Stock</h3>
  <div class="row-inline" style="margin-top:6px;">
    <label>Low Stock:</label>
    <input id="globalLimit" type="number" placeholder="2" style="width:90px;">
    <button id="setLimitBtn" class="small-btn">Set</button>
    <button id="clearStockBtn" class="small-btn" style="background:#fee2e2; border-color:#fecaca; color:#b91c1c;">Clear All</button>
    <button id="syncStockBtn" class="small-btn" title="Save stock to cloud">‚òÅÔ∏è Sync</button>
  </div>

  <div class="row-inline">
    <input id="pdate" type="date">
    <select id="ptype"></select>
    <input id="pname" type="text" placeholder="Product" style="min-width:140px;">
    <input id="pqty" type="number" placeholder="Qty" style="width:80px;">
    <input id="pcost" type="number" placeholder="Cost ‚Çπ" style="width:100px;">
    <button id="addStockBtn" class="small-btn">Add</button>
  </div>

  <div style="margin-top:12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
    <b>Filter Type:</b>
    <select id="filterType">
      <option value="all">All</option>
    </select>
    <input id="productSearch" placeholder="Search product..." style="min-width:160px;">
  </div>

  <div id="stockInvBox">
    üì¶ Stock Investment (Before Sale):
    <span id="stockInvValue" style="color:#ca8a04;">‚Çπ0</span>
    <div style="margin-top:8px;">
      <button id="exportStockBtn" class="small-btn">Export CSV</button>
      <button id="importStockBtn" class="small-btn">Import</button>
    </div>
  </div>

  <table id="stockTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Product</th>
        <th>Qty</th>
        <th>Sold</th>
        <th>Remain</th>
        <th>Alert</th>
        <th>Limit</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- ==================== SALES SECTION ==================== -->
<section id="sales" class="section">
  <h3>üí∞ Sales & Profit</h3>
  <div class="row-inline" style="margin:10px 0;">
    <label>Date:</label>
    <input id="saleDate" type="date">
    <label style="margin-left:4px">Filter Type:</label>
    <select id="saleType">
      <option value="all">All Types</option>
    </select>
    <label style="margin-left:4px">View:</label>
    <select id="saleView">
      <option value="all">All sales</option>
      <option value="cash">Cash sales</option>
      <option value="credit-pending">Credit (pending)</option>
      <option value="credit-paid">Credit paid history</option>
    </select>
    <button id="filterSalesBtn" class="small-btn" style="margin-left:4px">Filter</button>
    <button id="syncSalesBtn" class="small-btn" title="Save sales to cloud">‚òÅÔ∏è Sync</button>
    <button id="clearSalesBtn" class="small-btn" style="background:#fee2e2; color:#b91c1c; border-color:#fecaca; margin-left:8px">üóëÔ∏è Clear All</button>
  </div>

  <table id="salesTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Product</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Total</th>
        <th>Profit</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr>
        <td colspan="5" style="text-align:right">Total:</td>
        <td id="salesTotal">0</td>
        <td id="profitTotal">0</td>
        <td></td>
      </tr>
    </tfoot>
  </table>
</section>

<!-- ==================== WANTING SECTION ==================== -->
<section id="wanting" class="section">
  <h3>üõí Wanting List</h3>
  <div class="want-form row-inline" style="margin-bottom:10px;">
    <select id="wantType"></select>
    <input id="wantName" type="text" placeholder="Product" style="min-width:140px;">
    <input id="wantNote" type="text" placeholder="Note" style="min-width:160px;">
    <button id="addWantBtn" class="small-btn">Add</button>
    <button id="clearWantBtn" class="small-btn">Clear</button>
    <button id="printWantBtn" class="small-btn">Print</button>
    <button id="syncWantingBtn" class="small-btn" title="Save wanting list">‚òÅÔ∏è Sync</button>
  </div>

  <table id="wantingTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Product</th>
        <th>Note</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- =============== END OF PART 1 =============== -->
<!-- Part 2 will continue with Service, Expenses, Dashboard, Collection -->
<!-- Part 3 will contain Reset section and all scripts -->
  <!-- ==================== SERVICE SECTION ==================== -->
<section id="service" class="section">
  <h3>üõ† Service / Repair Manager</h3>

  <!-- Add New Repair Job (details) -->
  <details class="card" style="padding:14px; margin-bottom:14px; background:var(--white); border-radius:var(--radius-lg); border:1px solid var(--neutral-200);">
    <summary style="cursor:pointer; font-weight:600; padding:6px 0; color:var(--primary);">
      ‚ûï Add New Repair Job
    </summary>
    <div class="row-inline" style="margin-top:12px; gap:8px; flex-wrap:wrap;">
      <input id="svcReceivedDate" type="date" style="width:160px;">
      <input id="svcCustomer" type="text" placeholder="Customer name" style="min-width:160px;">
      <input id="svcPhone" type="text" placeholder="Phone Number" style="width:140px;">
      <select id="svcItemType" style="width:120px;">
        <option value="Mobile">Mobile</option>
        <option value="Laptop">Laptop</option>
        <option value="Other">Other</option>
      </select>
      <input id="svcModel" type="text" placeholder="Model" style="min-width:130px;">
      <input id="svcProblem" type="text" placeholder="Problem / Complaint" style="min-width:220px;">
      <input id="svcAdvance" type="number" placeholder="Advance ‚Çπ (0)" style="width:120px;">
      <button id="addServiceBtn" class="small-btn">Add Job</button>
      <button id="syncServiceBtn" class="small-btn" title="Save service jobs to cloud">‚òÅÔ∏è Sync</button>
    </div>
  </details>

  <!-- Summary Cards -->
  <div class="flex-row" style="margin:10px 0; gap:10px; flex-wrap:wrap;">
    <div class="card" style="flex:1; min-width:120px; padding:10px; background:var(--white); border-radius:var(--radius-lg); border:1px solid var(--neutral-200);">
      <small>Pending</small>
      <div id="svcPendingCount" style="font-size:20px; font-weight:700;">0</div>
    </div>
    <div class="card" style="flex:1; min-width:120px; padding:10px; background:#ecfdf5; border-radius:var(--radius-lg); border:1px solid #bbf7d0;">
      <small>Completed</small>
      <div id="svcCompletedCount" style="font-size:20px; font-weight:700; color:#16a34a;">0</div>
    </div>
    <div class="card" style="flex:1; min-width:150px; padding:10px; background:#fff7ed; border-radius:var(--radius-lg); border:1px solid #fed7aa;">
      <small>Total Repair Profit</small>
      <div id="svcTotalProfit" style="font-size:20px; font-weight:700; color:#c2410c;">‚Çπ0</div>
    </div>
  </div>

  <!-- Active Jobs Table -->
  <h4 style="margin-top:14px;">Active Jobs</h4>
  <table id="svcTable">
    <thead>
      <tr>
        <th>Job ID</th>
        <th>Received</th>
        <th>Customer</th>
        <th>Phone</th>
        <th>Item</th>
        <th>Model</th>
        <th>Problem</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="clearServiceBtn" class="small-btn" style="background:#fee2e2; color:#b91c1c; margin:14px 0; border-color:#fecaca;">
    üóëÔ∏è Clear All
  </button>

  <!-- History Section -->
  <h4 style="margin-top:20px;">Completed / History</h4>
  <div class="row-inline" style="gap:10px; margin:8px 0; flex-wrap:wrap;">
    <select id="svcFilterStatus">
      <option value="all">All Status</option>
      <option value="pending">Pending</option>
      <option value="completed">Cash Completed</option>
      <option value="credit">Credit Pending</option>
      <option value="credit-paid">Credit Paid</option>
      <option value="failed">Failed / Returned</option>
    </select>
    <select id="svcFilterType">
      <option value="all">All Types</option>
      <option value="Mobile">Mobile</option>
      <option value="Laptop">Laptop</option>
      <option value="Other">Other</option>
    </select>
    <input id="svcFilterCalendar" type="date">
  </div>

  <table id="svcHistoryTable">
    <thead>
      <tr>
        <th>Job ID</th>
        <th>Received</th>
        <th>Completed</th>
        <th>Customer</th>
        <th>Phone</th>
        <th>Item</th>
        <th>Investment</th>
        <th>Paid</th>
        <th>Profit</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Split View (Pie + Money Box) -->
  <div id="svcSplitView" style="display:flex; gap:20px; align-items:flex-start; margin-top:20px;">
    <div class="card" style="flex:1; max-width:360px; padding:14px; background:var(--white); border-radius:var(--radius-lg); border:1px solid var(--neutral-200);">
      <h4 style="text-align:center; margin-bottom:8px; font-size:14px;">Service Status Summary</h4>
      <div style="height:260px;">
        <canvas id="svcPieStatus"></canvas>
      </div>
    </div>
    <div id="svcMoneyBox" class="card" style="flex:1; padding:14px; background:var(--white); border-radius:var(--radius-lg); border:1px solid var(--neutral-200); border-left:1px dashed var(--ks-border-strong);">
      <!-- filled by service.js -->
    </div>
  </div>
</section>

<!-- ==================== EXPENSES SECTION ==================== -->
<section id="expenses" class="section">
  <h3>üßæ Expenses</h3>
  <div class="row-inline" style="margin-bottom:8px;">
    <input id="expDate" type="date">
    <input id="expCat" type="text" placeholder="Category" style="min-width:140px;">
    <input id="expAmount" type="number" placeholder="Amount" style="width:120px;">
    <input id="expNote" type="text" placeholder="Note" style="min-width:200px;">
    <button id="addExpenseBtn" class="small-btn">Add Expense</button>
    <button id="syncExpensesBtn" class="small-btn" title="Save expenses to cloud">‚òÅÔ∏è Sync</button>
    <button id="clearExpensesBtn" class="small-btn" style="background:#fee2e2; border-color:#fecaca; color:#b91c1c;">Clear All</button>
  </div>

  <table id="expensesTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Note</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr>
        <td colspan="2" style="text-align:right">Total:</td>
        <td id="expTotal">0</td>
        <td></td>
        <td></td>
      </tr>
    </tfoot>
  </table>
</section>

<!-- ==================== DASHBOARD SECTION ==================== -->
<section id="dashboard" class="section">
  <h3>üìä Dashboard (Today + Total)</h3>

  <!-- Today Cards -->
  <div id="summaryCards" class="flex-row" style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
    <div class="card" style="flex:1; min-width:140px; padding:10px; border-radius:14px; background:var(--white); border:1px solid var(--neutral-200);">
      <div style="font-size:24px">üí∞</div>
      <b id="todaySales" style="font-size:18px; color:var(--ks-accent);">‚Çπ0</b><br>
      <small>Today's Sales</small>
    </div>
    <div class="card" style="flex:1; min-width:140px; padding:10px; border-radius:14px; background:var(--white); border:1px solid var(--neutral-200);">
      <div style="font-size:24px">üí≥</div>
      <b id="todayCredit" style="font-size:18px; color:var(--ks-accent);">‚Çπ0</b><br>
      <small>Today's Credit</small>
    </div>
    <div class="card" style="flex:1; min-width:140px; padding:10px; border-radius:14px; background:#fff7ed; border-color:#fed7aa;">
      <div style="font-size:24px">üßæ</div>
      <b id="todayExpenses" style="font-size:18px; color:#ea580c;">‚Çπ0</b><br>
      <small>Today's Expenses</small>
    </div>
    <div class="card" style="flex:1; min-width:140px; padding:10px; border-radius:14px; background:#ecfdf5; border-color:#bbf7d0;">
      <div style="font-size:24px">üìà</div>
      <b id="todayGross" style="font-size:18px; color:#16a34a;">‚Çπ0</b><br>
      <small>Today's Gross Profit</small>
    </div>
    <div class="card" style="flex:1; min-width:140px; padding:10px; border-radius:14px; background:#ecfdf5; border-color:#bbf7d0;">
      <div style="font-size:24px">üíπ</div>
      <b id="todayNet" style="font-size:18px; color:#16a34a;">‚Çπ0</b><br>
      <small>Today's NET Profit</small>
    </div>
  </div>

  <hr style="margin:18px 0; border:none; border-top:1px dashed var(--ks-border-soft);">

  <!-- Total Dashboard -->
  <h4>Smart Dashboard (Total)</h4>
  <!-- Dashboard clear button (SAFE) -->
  <button onclick="clearDashboardView()" class="small-btn" style="background:#b91c1c; color:white; margin-bottom:10px;">
    üóëÔ∏è Clear Dashboard History View
  </button>

  <div class="flex-row" style="margin-bottom:18px; display:flex; gap:10px; flex-wrap:wrap;">
    <div class="card" style="flex:1; min-width:160px; padding:10px; border-radius:14px; background:#ecfdf5; border-color:#bbf7d0;">
      <h4 style="margin:0 0 4px 0; font-size:13px;">Total Profit</h4>
      <b id="dashProfit" style="font-size:22px; color:#16a34a;">‚Çπ0</b>
      <small>Sale + Service (collected only)</small>
    </div>
    <div class="card" style="flex:1; min-width:160px; padding:10px; border-radius:14px; background:#fff7ed; border-color:#fed7aa;">
      <h4 style="margin:0 0 4px 0; font-size:13px;">Total Expenses</h4>
      <b id="dashExpenses" style="font-size:22px; color:#ea580c;">‚Çπ0</b>
    </div>
    <div class="card" style="flex:1; min-width:160px; padding:10px; border-radius:14px; background:var(--white); border:1px solid var(--neutral-200);">
      <h4 style="margin:0 0 4px 0; font-size:13px;">Credit Sales (Pending)</h4>
      <b id="dashCredit" style="font-size:22px; color:var(--ks-accent);">‚Çπ0</b>
    </div>
    <div class="card" style="flex:1; min-width:160px; padding:10px; border-radius:14px; background:#fefce8; border-color:#facc15;">
      <h4 style="margin:0 0 4px 0; font-size:13px;">Total Investment (Sold Items)</h4>
      <b id="dashInv" style="font-size:22px; color:#ca8a04;">‚Çπ0</b>
      <small>Sold stock + Service invest</small>
    </div>
  </div>

  <!-- Pie Chart -->
  <div style="max-width:600px; margin:auto;">
    <canvas id="cleanPie" height="150"></canvas>
  </div>
</section>

<!-- ==================== COLLECTION SECTION ==================== -->
<section id="collection" class="section">
  <h3>ü™ô Collection Center</h3>

  <div class="flex-row" style="margin-bottom:14px; display:flex; gap:10px; flex-wrap:wrap;">
    <div class="card" style="flex:1; min-width:160px; padding:10px; border-radius:14px; background:#ecfdf5; border-color:#bbf7d0;">
      <h4 style="margin:0 0 4px 0; font-size:13px;">Sales Profit (Collected)</h4>
      <b id="colSales" style="font-size:20px; color:#16a34a;">‚Çπ0</b>
    </div>
    <div class="card" style="flex:1; min-width:160px; padding:10px; border-radius:14px; background:var(--white); border:1px solid var(--neutral-200);">
      <h4 style="margin:0 0 4px 0; font-size:13px;">Service Profit (Collected)</h4>
      <b id="colService" style="font-size:20px; color:var(--ks-accent);">‚Çπ0</b>
    </div>
    <div class="card" style="flex:1; min-width:160px; padding:10px; border-radius:14px; background:#fff7ed; border-color:#fed7aa;">
      <h4 style="margin:0 0 4px 0; font-size:13px;">Pending Credits</h4>
      <b id="colCredit" style="font-size:20px; color:#ea580c;">‚Çπ0</b>
    </div>
    <div class="card" style="flex:1; min-width:160px; padding:10px; border-radius:14px; background:#fefce8; border-color:#facc15;">
      <h4 style="margin:0 0 4px 0; font-size:13px;">Total Investment (Sold Items)</h4>
      <b id="colInvRemain" style="font-size:20px; color:#ca8a04;">‚Çπ0</b>
    </div>
  </div>

  <h4 style="margin-top:10px">Collection History</h4>
  <table id="collectionHistory">
    <thead>
      <tr>
        <th>Date</th>
        <th>Source</th>
        <th>Details</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="clearCollectionBtn" class="small-btn" style="background:#fee2e2; color:#b91c1c; margin-top:10px; border-color:#fecaca;">
    üóë Clear Collection History
  </button>
</section>
<!-- =============== END OF PART 2 =============== -->
  <!-- ==================== RESET SECTION ==================== -->
<section id="reset" class="section">
  <h3>üß® System Reset Center</h3>
  <div class="card" style="padding:18px; background:#fff1f2; border:1px solid #fecdd3; max-width:520px; border-radius:var(--radius-lg);">
    <h4 style="color:#b91c1c; margin-top:0;">‚ö†Ô∏è Danger Zone</h4>
    <p style="font-size:13px; line-height:1.6;">
      This will permanently delete ALL business data:
      <br>
      Types, Stock, Sales, Services, Expenses,
      Collections, Wanting, Offsets.
      <br><br>
      Dashboard history will also reset.
    </p>
    <button id="resetAllDataBtn" class="small-btn" style="background:#b91c1c; color:white; border:none;">üóëÔ∏è Reset Entire System</button>
  </div>
</section>

<!-- ==================== LIBRARIES ==================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<!-- ==================== CORE SCRIPTS (EXTERNAL) ==================== -->
<script src="/js/firebase.js"></script>
<script src="/js/core.js"></script>
<script src="/js/universalBar.js"></script>
<script src="/js/firestore-listeners.js"></script>
<script src="/js/types.js"></script>
<script src="/js/stock.js"></script>
<script src="/js/sales.js"></script>
<script src="/js/service.js"></script>
<script src="/js/wanting.js"></script>
<script src="/js/expenses.js"></script>
<script src="/js/collection.js"></script>
<script src="/js/analytics.js"></script>
<script src="/js/dashboard.js"></script>
<script src="/js/accounting-audit.js"></script>
<script src="/js/reset-engine.js"></script>
<script src="/js/security.js"></script>

<!-- ==================== RESET ENGINE (INLINE) ==================== -->
<script>
document.addEventListener("click", async e => {
  if (e.target.id !== "resetAllDataBtn") return;
  if (!confirm("‚ö†Ô∏è This will DELETE entire business system.\n\nContinue?")) return;
  if (!confirm("Final warning.\n\nAll data will be lost.\n\nProceed?")) return;
  try {
    /* LOCAL MEMORY RESET */
    window.types = [];
    window.stock = [];
    window.sales = [];
    window.services = [];
    window.expenses = [];
    window.collections = [];
    window.wanting = [];
    window.__dashboardOffset = 0;
    window.__dashboardViewCleared = false;

    /* CLOUD RESET */
    if (window.__cloudReady && typeof cloudSave === "function") {
      await cloudSave("types", []);
      await cloudSave("stock", []);
      await cloudSave("sales", []);
      await cloudSave("services", []);
      await cloudSave("expenses", []);
      await cloudSave("collections", []);
      await cloudSave("wanting", []);
      await cloudSave("dashboardOffset", 0);
    }

    /* UI REFRESH */
    renderStock?.();
    renderSales?.();
    renderWanting?.();
    renderExpenses?.();
    renderCollection?.();
    window.__svcRefresh?.();
    updateUniversalBar?.();
    renderAnalytics?.();
    updateSummaryCards?.();

    alert("‚úÖ System fully reset");
    console.log("üß® Full system reset completed");
  } catch (err) {
    console.error("‚ùå Reset failed", err);
    alert("Reset failed ‚Äî see console");
  }
});
</script>

<!-- ==================== TAB SWITCHER + HOOKS ==================== -->
<script>
function switchTab(id) {
  qsa(".section").forEach(sec => sec.classList.remove("active"));
  const target = qs("#" + id);
  if (target) target.classList.add("active");

  qsa(".tab").forEach(t => t.classList.remove("active"));
  const tab = qs(`.tab[data-tab="${id}"]`);
  if (tab) tab.classList.add("active");

  // call renderers if present (CLEANED)
  try { renderStock?.(); } catch {}
  try { renderSales?.(); } catch {}
  try { renderWanting?.(); } catch {}
  try { renderExpenses?.(); } catch {}
  try { window.__svcRefresh?.(); } catch {}
  try { renderCollection?.(); } catch {}
  try { updateSummaryCards?.(); } catch {}
}

document.addEventListener("click", e => {
  if (e.target.classList.contains("tab")) {
    switchTab(e.target.dataset.tab);
  }
});
</script>

<!-- ==================== CLOCK ==================== -->
<script>
function updateClock() {
  const d = new Date();
  const t = qs("#clockTime");
  const dt = qs("#clockDate");
  if (t) t.textContent = d.toLocaleTimeString();
  if (dt) dt.textContent = d.toLocaleDateString();
}
setInterval(updateClock, 1000);
updateClock();
</script>

<!-- ==================== THEME BUTTON (NO dark mode) ==================== -->
<script>
document.getElementById("themeBtn")?.addEventListener("click", () => {
  const btn = document.getElementById("themeBtn");
  btn.textContent = "üé®";
  btn.title = "Theme disabled (online-only build)";
});
</script>

<!-- ==================== LOGOUT BUTTON ==================== -->
<script>
document.getElementById("logoutBtn")?.addEventListener("click", async () => {
  try {
    if (window.fsLogout) {
      await window.fsLogout();
      return;
    }
  } catch (e) {
    console.error("Logout error:", e);
  }
  try { localStorage.removeItem("ks-user-email"); } catch {}
  window.location.href = "/login.html";
});
</script>

</body>
</html>

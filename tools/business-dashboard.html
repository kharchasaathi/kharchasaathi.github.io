<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üì¶ Business Dashboard ‚Äî KharchaSaathi</title>
<style>
  :root {
    --orange: #ff7a00;
    --orange-dark: #cc6300;
    --bg-light: #f8f9fa;
    --bg-dark: #121212;
    --card-light: #ffffff;
    --card-dark: #1e1e1e;
    --text-dark: #222;
    --text-light: #e8e8e8;
    --border-light: #ddd;
    --border-dark: #333;
  }

  body {
    font-family: "Poppins", Arial, sans-serif;
    background: var(--bg-light);
    margin: 0;
    padding: 20px;
    color: var(--text-dark);
    transition: 0.3s;
  }

  body.dark {
    background: var(--bg-dark);
    color: var(--text-light);
  }

  h2 {
    text-align: center;
    color: var(--orange);
  }

  .theme-toggle {
    position: fixed;
    top: 14px;
    right: 14px;
    background: var(--orange);
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    cursor: pointer;
    transition: 0.3s;
  }
  .theme-toggle:hover { background: var(--orange-dark); }

  .tabs {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 20px 0;
  }
  .tab {
    background: #ddd;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.3s;
  }
  body.dark .tab { background: #333; color: var(--text-light); }
  .tab.active { background: var(--orange); color: #fff; }

  .section {
    display: none;
    background: var(--card-light);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  body.dark .section {
    background: var(--card-dark);
    box-shadow: 0 2px 8px rgba(255,255,255,0.05);
  }
  .section.active { display: block; }

  input, button, select {
    padding: 8px;
    margin: 6px;
    border-radius: 6px;
    border: 1px solid var(--border-light);
    background: inherit;
    color: inherit;
  }
  body.dark input, body.dark select {
    border: 1px solid var(--border-dark);
    background: #2b2b2b;
    color: var(--text-light);
  }

  button {
    background: var(--orange);
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover { background: var(--orange-dark); }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid var(--border-light);
    padding: 8px;
    text-align: center;
  }
  body.dark th, body.dark td { border: 1px solid var(--border-dark); }
  th { background: var(--orange); color: white; }

  .clear-btn { background: #d9534f; }
  .clear-btn:hover { background: #b52b27; }

  .remove-btn, .restock-btn {
    border-radius: 5px;
    padding: 5px 10px;
    color: white;
  }
  .remove-btn { background: #dc3545; }
  .remove-btn:hover { background: #a71d2a; }
  .restock-btn { background: #28a745; }
  .restock-btn:hover { background: #1e7e34; }

  a.back-link {
    background: #444;
    color: #fff;
    padding: 10px 18px;
    border-radius: 8px;
    text-decoration: none;
    display: inline-block;
    margin-top: 20px;
  }
  a.back-link:hover { background: #222; }
</style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()">üåô</button>

<h2>üì¶ Business Dashboard</h2>

<div class="tabs">
  <div class="tab active" onclick="openTab('types')">üóÇ Manage Types</div>
  <div class="tab" onclick="openTab('stock')">üì¶ Current Stock</div>
  <div class="tab" onclick="openTab('sales')">üìà Sales Ledger</div>
  <div class="tab" onclick="openTab('wanting')">üõí Wanting List</div>
</div>

<!-- TYPES -->
<div id="types" class="section active">
  <h3>üóÇ Manage Item Types</h3>
  <input id="typeName" placeholder="Enter new type">
  <button onclick="addType()">Add Type</button>
  <button class="clear-btn" onclick="clearTypes()">üßπ Clear All Types</button>
  <h4>üìã Available Types</h4>
  <ul id="typeList"></ul>
</div>

<!-- STOCK -->
<div id="stock" class="section">
  <h3>üì¶ Current Stock</h3>
  <table id="stockTable">
    <thead><tr><th>Date</th><th>Type</th><th>Product</th><th>Qty</th><th>Sold</th><th>Remaining</th></tr></thead>
    <tbody></tbody>
  </table>
  <h4>Add New Stock</h4>
  <input id="pdate" type="date"><select id="ptype"></select>
  <input id="pname" placeholder="Product name"><input id="pqty" type="number" placeholder="Quantity">
  <button onclick="addStock()">Add</button>
  <button class="clear-btn" onclick="clearStock()">üßπ Clear Stock</button>
</div>

<!-- SALES -->
<div id="sales" class="section">
  <h3>üí∞ Sales Ledger</h3>
  <table id="salesTable">
    <thead><tr><th>Date</th><th>Type</th><th>Product</th><th>Qty</th><th>Price ‚Çπ</th><th>Total ‚Çπ</th></tr></thead>
    <tbody></tbody>
    <tfoot><tr><td colspan="5" style="text-align:right;font-weight:bold;">Day Total:</td><td id="dayTotal" style="font-weight:bold;color:var(--orange);">0</td></tr></tfoot>
  </table>

  <h4>Add Sale</h4>
  <input id="sdate" type="date"><select id="stype"></select>
  <input id="sname" placeholder="Product name"><input id="sqty" type="number" placeholder="Qty">
  <input id="sprice" type="number" placeholder="Price ‚Çπ">
  <button onclick="addSale()">Add Sale</button>
  <button class="clear-btn" onclick="clearSales()">üßπ Clear Sales</button>
  <button style="background:#2a9d8f;color:white;" onclick="downloadSalesPDF()">üñ®Ô∏è Download Sales PDF</button>
</div>

<!-- WANTING -->
<div id="wanting" class="section">
  <h3>üõí Wanting Items</h3>
  <table id="wantTable">
    <thead><tr><th>Date</th><th>Type</th><th>Item</th><th>Restocked Qty</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
  <h4>Add Wanting Item</h4>
  <input id="wdate" type="date"><select id="wtype"></select>
  <input id="witem" placeholder="Item name">
  <button onclick="addWant()">Add</button>
  <button class="clear-btn" onclick="clearWant()">üßπ Clear All</button>
  <button style="background:#2a9d8f;color:white;" onclick="downloadWantingPDF()">üñ®Ô∏è Download Wanting PDF</button>
</div>

<div style="text-align:center;">
  <a href="../index.html" class="back-link">‚Üê Back to Home</a>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let types = JSON.parse(localStorage.getItem('item-types')||'[]');
let stock = JSON.parse(localStorage.getItem('stock-data')||'[]');
let sales = JSON.parse(localStorage.getItem('sales-data')||'[]');
let want = JSON.parse(localStorage.getItem('wanting-data')||'[]');

// Theme
(function(){
  const t = localStorage.getItem('ks-theme');
  if(t==='dark'){document.body.classList.add('dark');document.querySelector('.theme-toggle').textContent='‚òÄÔ∏è';}
})();
function toggleTheme(){
  const d=document.body.classList.toggle('dark');
  localStorage.setItem('ks-theme',d?'dark':'light');
  document.querySelector('.theme-toggle').textContent=d?'‚òÄÔ∏è':'üåô';
}

// Tabs
function openTab(tab){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelector(`[onclick="openTab('${tab}')"]`).classList.add('active');
  document.getElementById(tab).classList.add('active');
}

// Types
function addType(){let name=document.getElementById('typeName').value.trim();
  if(!name)return alert("Enter type!");
  if(types.includes(name))return alert("Type exists!");
  types.push(name);localStorage.setItem('item-types',JSON.stringify(types));
  renderTypes();updateDropdowns();document.getElementById('typeName').value='';
}
function clearTypes(){if(confirm("Clear all types?")){types=[];localStorage.removeItem('item-types');renderTypes();updateDropdowns();}}
function renderTypes(){document.getElementById('typeList').innerHTML=types.length?types.map(t=>`<li>${t}</li>`).join(''):"<li>No types yet.</li>";}
function updateDropdowns(){
  const selects=[document.getElementById('ptype'),document.getElementById('stype'),document.getElementById('wtype')];
  selects.forEach(sel=>{sel.innerHTML='<option value="">Select Type</option>'+types.map(t=>`<option>${t}</option>`).join('');});
}

// Stock
function addStock(){let type=document.getElementById('ptype').value,name=document.getElementById('pname').value.trim(),
qty=parseInt(document.getElementById('pqty').value),date=document.getElementById('pdate').value;
  if(!type||!name||!qty||!date)return alert("Fill all fields!");
  stock.push({type,name,qty,sold:0,date});localStorage.setItem('stock-data',JSON.stringify(stock));
  renderStock();document.getElementById('pname').value='';document.getElementById('pqty').value='';
}
function renderStock(){
  const tb=document.querySelector('#stockTable tbody');
  tb.innerHTML=stock.length?stock.map(s=>{let remaining=s.qty-(s.sold||0);
    return `<tr><td>${s.date}</td><td>${s.type}</td><td>${s.name}</td><td>${s.qty}</td><td>${s.sold||0}</td><td>${remaining}</td></tr>`;}).join(''):"<tr><td colspan=6>No stock available.</td></tr>";
}
function clearStock(){if(confirm("Clear all stock?")){stock=[];localStorage.removeItem('stock-data');renderStock();}}

// Sales
function addSale(){
  let type=document.getElementById('stype').value,name=document.getElementById('sname').value.trim(),
  qty=parseInt(document.getElementById('sqty').value),price=parseFloat(document.getElementById('sprice').value),
  date=document.getElementById('sdate').value;
  if(!type||!name||!qty||!price||!date)return alert("Fill all fields!");
  sales.push({type,product:name,qty,price,amount:qty*price,date});
  localStorage.setItem('sales-data',JSON.stringify(sales));
  let item=stock.find(s=>s.name.toLowerCase()===name.toLowerCase());
  if(item){item.sold=(item.sold||0)+qty;localStorage.setItem('stock-data',JSON.stringify(stock));}
  renderStock();renderSales();
}
function renderSales(){
  const tb=document.querySelector('#salesTable tbody');
  if(!sales.length){tb.innerHTML="<tr><td colspan=6>No sales yet.</td></tr>";document.getElementById('dayTotal').textContent='0';return;}
  let total=0;
  tb.innerHTML=sales.map(s=>{total+=s.amount;return `<tr><td>${s.date}</td><td>${s.type}</td><td>${s.product}</td><td>${s.qty}</td><td>${s.price}</td><td>${s.amount}</td></tr>`;}).join('');
  document.getElementById('dayTotal').textContent=total.toFixed(2);
}
function clearSales(){if(confirm("Clear sales?")){sales=[];localStorage.removeItem('sales-data');renderSales();}}

async function downloadSalesPDF(){
  const { jsPDF } = window.jspdf; const doc = new jsPDF();
  doc.setFontSize(18);doc.text("üí∞ Sales Ledger Report",14,18);
  doc.setFontSize(12);doc.text(`Date: ${new Date().toLocaleDateString()}`,14,28);
  let y=38,total=0;
  doc.text("Type",14,y);doc.text("Product",44,y);doc.text("Qty",95,y);doc.text("Price ‚Çπ",120,y);doc.text("Total ‚Çπ",160,y);y+=8;
  sales.forEach(s=>{total+=s.amount;doc.text(s.type,14,y);doc.text(s.product,44,y);doc.text(String(s.qty),95,y);
    doc.text(String(s.price),120,y);doc.text(String(s.amount),160,y);y+=8;});
  y+=10;doc.setFontSize(13);doc.text(`Day Total: ‚Çπ${total.toFixed(2)}`,14,y);
  doc.save(`SalesLedger_${new Date().toLocaleDateString().replace(/\//g,'-')}.pdf`);
}

// Wanting
function addWant(){let type=document.getElementById('wtype').value,item=document.getElementById('witem').value.trim(),date=document.getElementById('wdate').value;
  if(!type||!item||!date)return alert("Fill all fields!");want.push({type,item,date});
  localStorage.setItem('wanting-data',JSON.stringify(want));renderWant();document.getElementById('witem').value='';
}
function removeWant(i){want.splice(i,1);localStorage.setItem('wanting-data',JSON.stringify(want));renderWant();}
function restockFromWant(i){
  let qty=prompt("Enter restocked qty:");if(!qty||isNaN(qty))return;
  const today=new Date().toISOString().split('T')[0];const item=want[i];
  stock.push({type:item.type,name:item.item,qty:parseInt(qty),sold:0,date:today});
  localStorage.setItem('stock-data',JSON.stringify(stock));want.splice(i,1);
  localStorage.setItem('wanting-data',JSON.stringify(want));renderStock();renderWant();
}
function clearWant(){if(confirm("Clear wanting list?")){want=[];localStorage.removeItem('wanting-data');renderWant();}}
function renderWant(){
  const tb=document.querySelector('#wantTable tbody');
  if(!want.length){tb.innerHTML="<tr><td colspan=5>No items.</td></tr>";return;}
  let grouped={};want.forEach(w=>{if(!grouped[w.type])grouped[w.type]=[];grouped[w.type].push(w);});
  tb.innerHTML=Object.entries(grouped).map(([type,items])=>`
  <tr><th colspan="5" style="background:#ffe0b3;">${type}</th></tr>
  ${items.map((w)=>`<tr><td>${w.date}</td><td>${w.type}</td><td>${w.item}</td><td>-</td>
  <td><button class='restock-btn' onclick='restockFromWant(${want.indexOf(w)})'>‚úî Restock</button>
  <button class='remove-btn' onclick='removeWant(${want.indexOf(w)})'>üóë Remove</button></td></tr>`).join('')}
  `).join('');
}

async function downloadWantingPDF(){
  const { jsPDF } = window.jspdf;const doc=new jsPDF();
  doc.setFontSize(18);doc.text("üõí Wanting List Report",14,18);
  doc.setFontSize(12);doc.text(`Date: ${new Date().toLocaleDateString()}`,14,28);
  let y=40;want.forEach(w=>{doc.text(`${w.type} - ${w.item}`,14,y);y+=8;});
  doc.save(`WantingList_${new Date().toLocaleDateString().replace(/\//g,'-')}.pdf`);
}

// Init
renderTypes();updateDropdowns();renderStock();renderSales();renderWant();
</script>
</body>
</html>

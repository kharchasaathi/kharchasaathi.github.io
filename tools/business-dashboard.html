<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸ“¦ KharchaSaathi â€” Business Dashboard (v3.3 Material)</title>
  <meta name="theme-color" content="#1565d8" />
  <link rel="icon" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/favicon.png" />

  <style>
    /* Material Design Blue Palette (from business-dashboard 19) */
    :root{
      --primary:#1565d8;
      --primary-dark:#0d47a1;
      --primary-soft:#e3f2fd;

      --accent-green:#1b9e64;
      --accent-red:#d32f2f;
      --accent-amber:#ffb300;
      --accent-grey:#607d8b;

      --bg:#eef3fb;          /* page background */
      --bg-soft:#f6f8ff;      /* soft panels */
      --card:#ffffff;
      --text:#1b2430;

      --dark-bg:#0b1020;
      --dark-card:#151b2c;
      --dark-text:#f5f6ff;
      --dark-border:#273148;

      --border-soft:#d5ddf5;
      --shadow-soft:0 14px 30px rgba(15, 35, 75, .08);
    }
    
    /* Common UI Elements from (19) */
    body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--bg);
        color: var(--text);
    }
    .container {
        width: 100%;
        max-width: 1160px;
        margin: auto;
        padding-left: 12px;
        padding-right: 12px;
    }
    .card {
        padding: 16px;
        border-radius: 12px;
        background: var(--card);
        box-shadow: var(--shadow-soft);
    }
    .tab-container {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px 0;
    }
    .tab {
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      border: 1px solid transparent;
      background: transparent;
      color: var(--accent-grey);
      transition: 0.16s;
    }
    .tab.active {
      background: var(--primary);
      color: #fff;
    }
    /* ... (You can add more styles from your base/layout/components CSS files here if needed) ... */
  </style>
  
  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/layout.css" />
  <link rel="stylesheet" href="/css/components.css" />
  <link rel="stylesheet" href="/css/table.css" /> 
</head>
<body>

  <header id="topbar">
    <div class="container flex justify-between items-center" style="height:60px;">
      <div class="flex items-center gap-2">
        <h2 id="clockTime" style="font-size:18px; color:var(--primary-dark);">00:00</h2>
        <small id="clockDate" style="color:var(--accent-grey);"></small>
      </div>
      
      <div class="flex items-center gap-3">
        <div id="universalBar" class="flex items-center gap-2" style="font-size:13px; font-weight:600;">
          <span style="color:var(--accent-green);">Profit: <span id="ubProfit">â‚¹0</span></span>
          <span style="color:var(--accent-amber);">Credit: <span id="ubCredit">â‚¹0</span></span>
        </div>
        
        <button class="small-btn btn-danger" onclick="logoutUser()">
          Logout
        </button>
      </div>
    </div>
  </header>

  <nav id="navtabs" style="background:var(--bg-soft); border-bottom:1px solid var(--border-soft);">
    <div class="container tab-container">
      <button class="tab active" data-tab="overview">Dashboard</button>
      <button class="tab" data-tab="stock">Stock</button>
      <button class="tab" data-tab="sales">Sales</button>
      <button class="tab" data-tab="types">Types</button>
      <button class="tab" data-tab="wanting">Wanting</button>
      <button class="tab" data-tab="expenses">Expenses</button>
      <button class="tab" data-tab="service">Service</button>
      <button class="tab" data-tab="collection">Collection</button>
    </div>
  </nav>

  <main>
    <div class="container">
      
      <section id="overview" class="section active">
        <h2>ðŸ“Š Dashboard</h2>
        <div class="grid-4" style="margin-bottom:20px;">
          <div class="card">Today Sales: <span id="todaySales">â‚¹0</span></div>
          <div class="card">Credit Sales: <span id="todayCredit">â‚¹0</span></div>
          <div class="card">Today Expenses: <span id="todayExpenses">â‚¹0</span></div>
          <div class="card">Net Profit: <span id="todayNet">â‚¹0</span></div>
        </div>
        
        <h3>Overall Analytics</h3>
        <canvas id="cleanPieChart" style="max-width:400px; margin:20px auto;"></canvas>
      </section>

      <section id="stock" class="section">
        <h2>ðŸ“¦ Stock Management</h2>
        
        <div class="card flex flex-wrap gap-3" style="margin-bottom:20px;">
          <select id="productType" style="width:150px;">
            <option value="">Select Type</option>
          </select>
          <input type="text" id="productName" placeholder="Product Name" style="flex-grow:1;"/>
          <input type="number" id="productQty" placeholder="Qty" style="width:80px;"/>
          <input type="number" id="productCost" placeholder="Cost" style="width:100px;"/>
          <input type="number" id="productLimit" placeholder="Limit" style="width:80px;"/>
          <button class="btn" id="addStockBtn">âž• Add Stock</button>
        </div>
        
        <div class="flex justify-between items-center" style="margin-bottom:10px;">
          <div class="flex gap-2">
            <select id="filterType" style="width:150px;">
              <option value="all">All Types</option>
            </select>
            <input type="text" id="productSearch" placeholder="Search Product..." style="width:200px;"/>
          </div>
          <div>
            <span style="font-weight:600;">Investment: </span><span id="stockInvValue">â‚¹0</span>
            <button class="small-btn btn-danger" id="clearStockBtn">ðŸ—‘ Clear All</button>
          </div>
        </div>
        
        <table id="stockTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Product</th>
              <th>Qty</th>
              <th>Sold</th>
              <th>Remain</th>
              <th>Alert</th>
              <th>Limit</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="stockTableBody">
            </tbody>
        </table>
      </section>

      <section id="sales" class="section">
        <h2>ðŸ’¸ Sales History</h2>
        </section>

      <section id="types" class="section">
        <h2>ðŸ—‚ Manage Product Types</h2>
        
        <div class="card flex gap-3" style="margin-bottom:20px;">
          <input type="text" id="typeName" placeholder="Enter New Type Name (e.g., Mobiles, Accessories)" style="flex-grow:1;"/>
          <button class="btn" id="addTypeBtn">âž• Add Type</button>
        </div>

        <div class="flex justify-between items-center" style="margin-bottom:10px;">
          <h3>Existing Types</h3>
          <button class="small-btn btn-danger" id="clearTypesBtn">ðŸ—‘ Clear All</button>
        </div>
        
        <table id="typesTable">
          <thead>
            <tr>
              <th>Type Name</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="typesTableBody">
            </tbody>
        </table>
      </section>

      <section id="wanting" class="section">
        <h2>ðŸ›’ Wanting List</h2>
        </section>

      <section id="expenses" class="section">
        <h2>ðŸ§¾ Expenses</h2>
        </section>

      <section id="service" class="section">
        <h2>ðŸ›  Service/Repair Jobs</h2>
        </section>

      <section id="collection" class="section">
        <h2>ðŸ’° Collection History</h2>
        </section>
      
    </div>
  </main>

  <script>
    function qs(s) { return document.querySelector(s); }
    function qsa(s) { return Array.from(document.querySelectorAll(s)); }
  </script>

  <script>
    // Dynamically load all JS files with a version number
    (function loadScripts() {
      const v = 34; // Version control
      const js = [
        "/js/core.js", // Core helpers and initial data loading
        "/js/firebase.js", // Cloud sync and auth
        "/js/universalBar.js",
        "/js/analytics.js",
        "/js/security.js",
        "/js/types.js", 
        "/js/stock.js",
        "/js/sales.js",
        "/js/wanting.js",
        "/js/expenses.js",
        "/js/service.js",
        "/js/collection.js",
      ];
      // Note: document.write is used here as per the old version (19) structure.
      js.forEach(f => {
        document.write(`<script src="${f}?v=${v}"><\/script>`);
      });
    })();
  </script>

  <script>
    // Switch function is made global for use in other JS files
    window.switchTab = function(id) {
      // Hide all sections
      qsa(".section").forEach(sec => sec.classList.remove("active"));
      // Show selected
      const target = qs("#" + id);
      if (target) target.classList.add("active");

      // Highlight tab
      qsa(".tab").forEach(t => t.classList.remove("active"));
      const tab = qs(`.tab[data-tab="${id}"]`);
      if (tab) tab.classList.add("active");

      // Refresh screens
      // This ensures data is up to date when switching tabs
      try { renderTypes?.(); } catch {}
      try { renderStock?.(); } catch {}
      try { renderSales?.(); } catch {}
      try { renderWanting?.(); } catch {}
      try { renderExpenses?.(); } catch {}
      try { renderServiceTables?.(); } catch {}
      try { renderCollection?.(); } catch {}
      try { renderAnalytics?.(); } catch {}
      try { updateSummaryCards?.(); } catch {}
      try { window.updateUniversalBar?.(); } catch {}
    }

    document.addEventListener("click", e => {
      if (e.target.classList.contains("tab")) {
        switchTab(e.target.dataset.tab);
      }
    });

    // Initial load switch
    window.addEventListener("load", () => {
      switchTab("overview");
    });
  </script>

  <script>
    function updateClock() {
      const d = new Date();
      const t = qs("#clockTime");
      const dt = qs("#clockDate");
      if (t) t.textContent = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      if (dt) dt.textContent = d.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
    }
    setInterval(updateClock, 1000);
    updateClock();
  </script>

</body>
</html>

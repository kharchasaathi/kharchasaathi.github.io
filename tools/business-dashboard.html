<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üì¶ KharchaSaathi ‚Äî Business Dashboard (v3.3 Material)</title>
  <meta name="theme-color" content="#1565d8" />
  <link rel="icon" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/favicon.png" />

  <style>
    :root{
      /* MAIN MATERIAL BLUE PALETTE */
      --primary:#1565d8;
      --primary-dark:#0d47a1;
      --primary-soft:#e3f2fd;

      --accent-green:#1b9e64;
      --accent-red:#d32f2f;
      --accent-amber:#ffb300;
      --accent-grey:#607d8b;

      --bg:#eef3fb;          /* page background */
      --bg-soft:#f6f8ff;      /* soft panels */
      --card:#ffffff;
      --text:#1b2430;

      --dark-bg:#0b1020;
      --dark-card:#151b2c;
      --dark-text:#f5f6ff;
      --dark-border:#273148;

      --border-soft:#d5ddf5;
      --shadow-soft:0 14px 30px rgba(15, 35, 95, 0.15);
    }

    *{
      box-sizing:border-box;
      transition:background .18s,color .18s,border-color .18s,box-shadow .18s;
    }

    body{
      margin:0;
      padding:18px;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      background:radial-gradient(circle at top left,#e3f2fd,#eef3fb 45%,#edf2ff 80%);
      color:var(--text);
    }
    body.dark{
      background:radial-gradient(circle at top left,#050814,#0b1020 45%,#050814 90%);
      color:var(--dark-text);
    }

    /* ---------- TOPBAR ---------- */
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    h1{
      margin:0;
      font-size:22px;
      font-weight:700;
      letter-spacing:.02em;
      color:var(--primary);
    }
    #emailTag{
      font-size:13px;
      opacity:.9;
      background:#e6edff;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border-soft);
    }
    body.dark #emailTag{
      background:#151c34;
      border-color:#273148;
      color:#d7e1ff;
    }

    /* ---------- CLOCK ---------- */
    .simple-clock{
      display:flex;
      flex-direction:column;
      line-height:1.1;
      padding:4px 0;
      min-width:95px;
      text-align:right;
    }
    .clock-line{
      font-family:monospace;
      font-size:14px;
      font-weight:700;
      color:var(--primary);
    }
    .clock-line.small{
      font-size:11px;
      opacity:0.8;
      color:var(--text);
    }
    body.dark .clock-line.small{
      color:#d0dbff;
    }

    /* ---------- BUTTONS ---------- */
    .theme-btn,.small-btn{
      background:var(--primary);
      color:#fff;
      border:none;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-size:13px;
      font-weight:500;
      box-shadow:0 4px 10px rgba(21,101,216,0.3);
    }
    .theme-btn:hover,.small-btn:hover{
      background:var(--primary-dark);
    }
    .small-btn{
      padding:6px 11px !important;
      font-size:12px;
      box-shadow:none;
    }

    /* ---------- GENERIC LAYOUT HELPERS ---------- */
    .flex-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:stretch;
    }
    .row-inline{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .card{
      background:var(--card);
      border-radius:18px;
      padding:10px 12px;
      box-shadow:0 8px 20px rgba(16,33,80,0.08);
      border:1px solid rgba(206,214,242,0.9);
    }
    body.dark .card{
      background:var(--dark-card);
      border-color:var(--dark-border);
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
    }

    /* ---------- TABS ---------- */
    .tabs{
      display:flex;
      gap:8px;
      margin:10px 0 16px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .tab{
      background:#dde4f7;
      padding:7px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
      white-space:nowrap;
      font-size:13px;
      border:1px solid transparent;
    }
    .tab.active{
      background:var(--primary);
      color:#fff;
      box-shadow:0 5px 12px rgba(21,101,216,0.35);
      border-color:rgba(0,0,0,0.0);
    }
    body.dark .tab{
      background:#151c34;
      color:#c5d2ff;
      border-color:#273148;
    }
    body.dark .tab.active{
      background:var(--primary-dark);
      color:#fff;
    }

    /* ---------- SECTION (big cards) ---------- */
    .section{
      display:none;
      background:var(--bg-soft);
      padding:16px 14px 18px;
      border-radius:20px;
      box-shadow:var(--shadow-soft);
      margin-bottom:18px;
      border:1px solid var(--border-soft);
    }
    .section.active{display:block;}
    body.dark .section{
      background:#111729;
      border-color:var(--dark-border);
    }
    .section h3{
      margin-top:0;
      margin-bottom:10px;
      font-size:17px;
      letter-spacing:.01em;
    }

    /* ==========================================
       PROFESSIONAL TABLES (Excel-style)
    =========================================== */
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      background:var(--card);
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 8px 20px rgba(16,33,80,0.08);
    }
    table thead{
      background:linear-gradient(90deg,#1565d8,#1e88e5);
      color:#fff;
    }
    table thead th{
      padding:9px 8px;
      text-align:left;
      font-weight:600;
      border-bottom:1px solid rgba(255,255,255,0.22);
      border-right:1px solid rgba(255,255,255,0.14);
      white-space:nowrap;
    }
    table thead th:last-child{
      border-right:none;
    }

    table tbody tr{
      background:var(--card);
    }
    body.dark table tbody tr{
      background:var(--dark-card);
    }

    table td{
      padding:8px 8px;
      vertical-align:middle;
      border-top:1px solid var(--border-soft);
      border-right:1px solid var(--border-soft);
    }
    table td:last-child{
      border-right:none;
    }
    table tbody tr:hover{
      background:#f3f6ff;
    }
    body.dark table tbody tr:hover{
      background:#182237;
    }

    table tfoot td{
      padding:8px;
      border-top:1px solid var(--border-soft);
      font-weight:600;
      background:#f5f7ff;
    }
    body.dark table tfoot td{
      background:#151c34;
      border-color:#273148;
    }

    /* MOBILE RESPONSIVE TABLES */
    @media (max-width: 720px){
      table,
      table thead,
      table tbody,
      table th,
      table td,
      table tr { display:block; }
      table{
        border-radius:14px;
        box-shadow:none;
        background:transparent;
      }
      table thead{
        display:none;
      }
      table tbody tr{
        margin-bottom:10px;
        border-radius:14px;
        box-shadow:0 6px 14px rgba(16,33,80,0.1);
        overflow:hidden;
      }
      table tbody td{
        display:flex;
        justify-content:space-between;
        align-items:center;
        border-right:none;
      }
      table tbody td:before{
        content:attr(data-label);
        font-weight:600;
        opacity:.7;
        margin-right:8px;
      }
    }

    /* ---------- UNIVERSAL TOP METRICS BAR ---------- */
    #universalBar{
      position:sticky;
      top:0;
      z-index:5;
      padding:6px 0 12px;
      background:linear-gradient(to bottom,rgba(238,243,251,0.97),rgba(238,243,251,0.8));
      backdrop-filter:blur(10px);
    }
    body.dark #universalBar{
      background:linear-gradient(to bottom,rgba(11,16,32,0.96),rgba(11,16,32,0.85));
    }
    .uni-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:stretch;
    }
    .uni-card{
      background:var(--card);
      border-radius:20px;
      padding:8px 11px;
      display:flex;
      flex-direction:column;
      min-width:180px;
      flex:1;
      box-shadow:0 10px 24px rgba(16,33,80,0.18);
      border:1px solid var(--border-soft);
      position:relative;
      overflow:hidden;
    }
    .uni-card.main{
      flex:2;
      min-width:260px;
    }
    body.dark .uni-card{
      background:#131a30;
      border-color:#273148;
      box-shadow:0 14px 32px rgba(0,0,0,0.7);
    }
    .uni-title{
      opacity:.8;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.09em;
    }
    .uni-value{
      font-size:20px;
      font-weight:700;
      line-height:1.3;
      margin-top:4px;
    }
    .uni-value.small{
      font-size:18px;
    }
    .uni-sub{
      margin-top:3px;
      font-size:10px;
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      align-items:center;
      opacity:.9;
    }
    .uni-exp-label{
      color:var(--accent-red);
      font-weight:600;
    }
    .uni-exp-value{
      color:var(--accent-red);
      font-weight:600;
    }

    /* Collect Buttons INSIDE card, on right side */
    .uni-actions{
      position:absolute;
      right:10px;
      bottom:8px;
      display:flex;
      gap:6px;
      align-items:center;
    }
    .uni-collect{
      background:var(--accent-green);
      border:none;
      color:#fff;
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      cursor:pointer;
      box-shadow:0 4px 10px rgba(27,158,100,0.6);
      white-space:nowrap;
    }
    .uni-collect:hover{
      background:#128256;
    }
    .uni-pill-label{
      font-size:10px;
      padding:2px 8px;
      border-radius:999px;
      background:rgba(21,101,216,0.09);
      color:var(--accent-grey);
    }
    body.dark .uni-pill-label{
      background:rgba(96,125,139,0.26);
      color:#d0e3ff;
    }

    /* ---------- SMALL STICKY PADDING ON MOBILE ---------- */
    @media (max-width:720px){
      #universalBar{
        padding-bottom:8px;
      }
      .uni-card{
        border-radius:18px;
      }
    }
  </style>
</head>

<body>

<!-- ‚≠ê GLOBAL HELPERS (qs / qsa) -->
<script>
  const qs  = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
</script>

<!-- üîê TOPBAR -->
<div class="topbar">
  <h1>üì¶ KharchaSaathi (Offline)</h1>

  <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
    <span id="emailTag">Loading...</span>

    <!-- SIMPLE CLOCK -->
    <div class="simple-clock">
      <span id="clockTime" class="clock-line">--:--:--</span>
      <span id="clockDate" class="clock-line small">--</span>
    </div>

    <button id="themeBtn" class="theme-btn">üåô</button>
    <a class="small-btn" href="/index.html">üè† Back</a>
    <button id="logoutBtn" class="small-btn" style="background:#e53935">üîì Logout</button>
  </div>
</div>

<!-- üî∂ UNIVERSAL TOP METRICS BAR (VISIBLE ON ALL TABS) -->
<div id="universalBar">
  <div class="uni-row">

    <!-- NET PROFIT MAIN CARD -->
    <div class="uni-card main">
      <div class="uni-title">Net Profit (Sale + Service ‚àí Expenses)</div>
      <div class="uni-value" id="unNetProfit">‚Çπ0</div>
      <div class="uni-sub">
        <span>Sale:</span><span id="unSaleProfit"   style="font-weight:600;">‚Çπ0</span>
        <span>Service:</span><span id="unServiceProfit" style="font-weight:600;">‚Çπ0</span>
        <span class="uni-exp-label">Exp:</span>
        <span id="unExpenses" class="uni-exp-value">‚Çπ0</span>
      </div>
      <div class="uni-actions">
        <span class="uni-pill-label">Today's profit</span>
        <button class="uni-collect" id="collectNetProfitBtn">Collect</button>
      </div>
    </div>

    <!-- STOCK INVEST (AFTER SALE) -->
    <div class="uni-card">
      <div class="uni-title">Stock Investment (After Sale)</div>
      <div class="uni-value small" id="unStockInv">‚Çπ0</div>
      <div class="uni-actions">
        <span class="uni-pill-label">Remaining stock</span>
        <button class="uni-collect" id="collectStockInvBtn">Collect</button>
      </div>
    </div>

    <!-- SERVICE INVESTMENT -->
    <div class="uni-card">
      <div class="uni-title">Service Investment (Completed)</div>
      <div class="uni-value small" id="unServiceInv">‚Çπ0</div>
      <div class="uni-actions">
        <span class="uni-pill-label">Closed jobs</span>
        <button class="uni-collect" id="collectServiceInvBtn">Collect</button>
      </div>
    </div>

    <!-- CREDIT SALES -->
    <div class="uni-card">
      <div class="uni-title">Pending Credit Sales</div>
      <div class="uni-value small" id="unCreditSales">‚Çπ0</div>
      <div class="uni-actions">
        <span class="uni-pill-label">To be collected</span>
      </div>
    </div>

  </div>
</div>

<!-- =============== FIXED TAB ORDER =============== -->
<div class="tabs" role="tablist">
  <div class="tab active" data-tab="types">üóÇ Types</div>
  <div class="tab" data-tab="stock">üì¶ Stock</div>
  <div class="tab" data-tab="sales">üìà Sales</div>
  <div class="tab" data-tab="wanting">üõí Wanting</div>
  <div class="tab" data-tab="service">üõ† Service</div>
  <div class="tab" data-tab="expenses">üí∏ Expenses</div>
  <div class="tab" data-tab="dashboard">üìä Overview</div>
  <div class="tab" data-tab="analytics">üìà Smart Dashboard</div>
  <div class="tab" data-tab="collection">ü™ô Collection</div>
</div>
<!-- =============== TYPES =============== -->
<section id="types" class="section active">
  <h3>üóÇ Manage Item Types</h3>

  <div class="row-inline" style="margin-top:8px">
    <input id="typeName" type="text" placeholder="Add new type" style="flex:1;min-width:160px">
    <button id="addTypeBtn" class="small-btn">Add</button>
    <button id="clearTypesBtn" class="small-btn">Clear All</button>
  </div>

  <ul id="typeList" style="margin-top:10px;padding-left:18px"></ul>
</section>

<!-- =============== STOCK =============== -->
<section id="stock" class="section">
  <h3>üì¶ Current Stock</h3>

  <div class="row-inline" style="margin-top:6px">
    <label>Low Stock:</label>
    <input id="globalLimit" type="number" placeholder="2" style="width:80px">
    <button id="setLimitBtn" class="small-btn">Set</button>
    <button id="clearStockBtn" class="small-btn">Clear All</button>
  </div>

  <div class="row-inline" style="margin-top:12px">
    <input id="pdate" type="date">
    <select id="ptype"></select>
    <input id="pname" type="text" placeholder="Product">
    <input id="pqty" type="number" placeholder="Qty" style="width:80px">
    <input id="pcost" type="number" placeholder="Cost ‚Çπ" style="width:90px">
    <button id="addStockBtn" class="small-btn">Add</button>
  </div>

  <div style="margin-top:12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
    <b>Filter Type:</b>
    <select id="filterType"><option value="all">All</option></select>

    <input id="productSearch"
           placeholder="Search product..."
           style="padding:6px; margin-left:10px;flex:1;min-width:140px;">
  </div>

  <!-- BEFORE SALE INVESTMENT (NO COLLECT BUTTON) -->
  <div id="stockInvBox" 
       style="margin-top:10px; padding:10px; background:#fff9e6; border-radius:14px;
              border:1px solid #ffecb3; max-width:280px; margin-left:auto;
              font-weight:600; font-size:13px;">
    üì¶ Stock Investment (Before Sale): 
    <span id="stockInvValue" style="color:#ff8f00;">‚Çπ0</span>
  </div>

  <table id="stockTable" style="margin-top:10px;">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Product</th>
        <th>Qty</th>
        <th>Sold</th>
        <th>Remain</th>
        <th>Alert</th>
        <th>Limit</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- =============== SALES =============== -->
<section id="sales" class="section">
  <h3>üí∞ Sales & Profit</h3>

  <div class="row-inline" style="margin:10px 0">
    <label>Date:</label>
    <input id="saleDate" type="date">

    <label style="margin-left:8px">Filter Type:</label>
    <select id="saleType">
      <option value="all">All Types</option>
    </select>

    <button id="filterSalesBtn" class="small-btn" style="margin-left:8px">Filter</button>

    <button id="clearSalesBtn" class="small-btn" 
      style="background:#c62828;color:#fff;margin-left:10px">üóëÔ∏è Clear All</button>
  </div>

  <table id="salesTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Product</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Total</th>
        <th>Profit</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>

    <tfoot>
      <tr>
        <td colspan="5" style="text-align:right">Total:</td>
        <td id="salesTotal">0</td>
        <td id="profitTotal">0</td>
        <td></td>
      </tr>
    </tfoot>
  </table>
</section>
<!-- =============== WANTING =============== -->
<section id="wanting" class="section">
  <h3>üõí Wanting List</h3>

  <div class="want-form row-inline" style="margin-bottom:10px;">
    <select id="wantType"></select>
    <input id="wantName" type="text" placeholder="Product">
    <input id="wantNote" type="text" placeholder="Note" style="flex:1;min-width:160px">
    <button id="addWantBtn" class="small-btn">Add</button>
    <button id="clearWantBtn" class="small-btn">Clear</button>
    <button id="printWantBtn" class="small-btn">Print</button>
  </div>

  <table id="wantingTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Product</th>
        <th>Note</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- =============== SERVICE =============== -->
<section id="service" class="section">
  <h3>üõ† Service / Repair Manager</h3>

  <div class="row-inline" style="margin:10px 0;align-items:center;gap:10px">
    <input id="svcReceivedDate" type="date" style="width:160px">
    <input id="svcCustomer" type="text" placeholder="Customer name" style="min-width:160px">
    <input id="svcPhone" type="text" placeholder="Phone Number" style="width:140px">
    <select id="svcItemType" style="width:120px">
      <option value="Mobile">Mobile</option>
      <option value="Laptop">Laptop</option>
      <option value="Other">Other</option>
    </select>
    <input id="svcModel" type="text" placeholder="Model" style="min-width:130px">
    <input id="svcProblem" type="text" placeholder="Problem / Complaint" style="min-width:220px">
    <input id="svcAdvance" type="number" placeholder="Advance ‚Çπ (0)" style="width:120px">
    <button id="addServiceBtn" class="small-btn">Add Job</button>
  </div>

  <div class="flex-row" style="margin:8px 0;">
    <div class="card" style="flex:1;min-width:120px;text-align:center;">
      <small>Pending</small>
      <div id="svcPendingCount" style="font-size:18px;font-weight:700;">0</div>
    </div>
    <div class="card" style="flex:1;min-width:120px;text-align:center;">
      <small>Completed</small>
      <div id="svcCompletedCount" style="font-size:18px;font-weight:700;">0</div>
    </div>
    <div class="card" style="flex:1;min-width:160px;text-align:center;">
      <small>Total Repair Profit</small>
      <div id="svcTotalProfit" style="font-size:18px;font-weight:700;color:var(--accent-green);">‚Çπ0</div>
    </div>
  </div>

  <h4>Pending / Active Jobs</h4>
  <table id="svcTable">
    <thead>
      <tr>
        <th>Job ID</th>
        <th>Received</th>
        <th>Customer</th>
        <th>Phone</th>
        <th>Item</th>
        <th>Model</th>
        <th>Problem</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="clearServiceBtn"
    class="small-btn"
    style="background:#b71c1c;color:white;margin:10px 0;">üóëÔ∏è Clear All Jobs</button>

  <h4 style="margin-top:14px">Completed / History</h4>
  <table id="svcHistoryTable">
    <thead>
      <tr>
        <th>Job ID</th>
        <th>Received</th>
        <th>Completed</th>
        <th>Customer</th>
        <th>Item</th>
        <th>Invest</th>
        <th>Paid</th>
        <th>Profit</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="max-width:520px;margin:14px auto;">
    <canvas id="svcPie" height="150"></canvas>
  </div>
</section>

<!-- =============== EXPENSES =============== -->
<section id="expenses" class="section">
  <h3>üßæ Expenses</h3>

  <div class="row-inline" style="margin-bottom:8px">
    <input id="expDate" type="date" onfocus="if(!this.value)this.value=todayDate()">
    <input id="expCat" type="text" placeholder="Category" style="min-width:140px">
    <input id="expAmount" type="number" placeholder="Amount" style="width:120px">
    <input id="expNote" type="text" placeholder="Note" style="min-width:200px;flex:1;">
    <button id="addExpenseBtn" class="small-btn">Add Expense</button>
  </div>

  <table id="expensesTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Note</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>

    <tfoot>
      <tr>
        <td colspan="2" style="text-align:right">Total:</td>
        <td id="expTotal">0</td>
        <td></td>
        <td></td>
      </tr>
    </tfoot>
  </table>
</section>

<!-- =============== OVERVIEW =============== -->
<section id="dashboard" class="section">
  <h3>üìä Business Overview (Today)</h3>

  <div id="summaryCards" class="flex-row" style="margin-top:10px">

    <div class="card" style="flex:1;min-width:160px;text-align:center;">
      <div style="font-size:26px">üí∞</div>
      <b id="todaySales" style="font-size:20px;color:var(--primary)">‚Çπ0</b><br>
      <small>Today's Sales</small>
    </div>

    <div class="card" style="flex:1;min-width:160px;text-align:center;">
      <div style="font-size:26px">üí≥</div>
      <b id="todayCredit" style="font-size:20px;color:#1565c0">‚Çπ0</b><br>
      <small>Today's Credit</small>
    </div>

    <div class="card" style="flex:1;min-width:160px;text-align:center;">
      <div style="font-size:26px">üßæ</div>
      <b id="todayExpenses" style="font-size:20px;color:#d32f2f">‚Çπ0</b><br>
      <small>Today's Expenses</small>
    </div>

    <div class="card" style="flex:1;min-width:160px;text-align:center;">
      <div style="font-size:26px">üìà</div>
      <b id="todayGross" style="font-size:20px;color:var(--accent-green)">‚Çπ0</b><br>
      <small>Today's Gross Profit</small>
    </div>

    <div class="card" style="flex:1;min-width:160px;text-align:center;">
      <div style="font-size:26px">üíπ</div>
      <b id="todayNet" style="font-size:20px;color:var(--primary-dark)">‚Çπ0</b><br>
      <small>Today's NET Profit</small>
    </div>

  </div>
</section>

<!-- =============== SMART DASHBOARD =============== -->
<section id="analytics" class="section">
  <h3>üìà Smart Dashboard (Total)</h3>

  <div class="flex-row" style="margin-bottom:18px">
    <div class="card" style="flex:1;min-width:160px">
      <h4>Total Profit</h4>
      <b id="dashProfit" style="font-size:22px;color:#2e7d32">‚Çπ0</b>
      <small>Sale + Service (collected only)</small>
    </div>

    <div class="card" style="flex:1;min-width:160px">
      <h4>Total Expenses</h4>
      <b id="dashExpenses" style="font-size:22px;color:#c62828">‚Çπ0</b>
    </div>

    <div class="card" style="flex:1;min-width:160px">
      <h4>Credit Sales (Pending)</h4>
      <b id="dashCredit" style="font-size:22px;color:#1565c0">‚Çπ0</b>
    </div>

    <div class="card" style="flex:1;min-width:160px">
      <h4>Total Investment (After Sale)</h4>
      <b id="dashInv" style="font-size:22px;color:#fbc02d">‚Çπ0</b>
      <small>Stock remain + Service invest</small>
    </div>
  </div>

  <div style="max-width:600px;margin:auto;">
    <canvas id="cleanPie" height="150"></canvas>
  </div>
</section>
<!-- =============== COLLECTION TAB =============== -->
<section id="collection" class="section">
  <h3>ü™ô Collection Center</h3>

  <!-- SUMMARY CARDS -->
  <div class="flex-row" style="margin-bottom:14px">

    <div class="card" style="flex:1;min-width:160px">
      <h4>Sales Profit (Collected)</h4>
      <b id="colSales" style="font-size:20px;color:#2e7d32">‚Çπ0</b>
    </div>

    <div class="card" style="flex:1;min-width:160px">
      <h4>Service Profit (Collected)</h4>
      <b id="colService" style="font-size:20px;color:#1976d2">‚Çπ0</b>
    </div>

    <div class="card" style="flex:1;min-width:160px">
      <h4>Pending Credits</h4>
      <b id="colCredit" style="font-size:20px;color:#d32f2f">‚Çπ0</b>
    </div>

    <div class="card" style="flex:1;min-width:160px">
      <h4>Total Investment (After Sale)</h4>
      <b id="colInvRemain" style="font-size:20px;color:#f57f17">‚Çπ0</b>
    </div>

  </div>

  <!-- PENDING COLLECTIONS -->
  <h4>Pending Collections</h4>
  <table id="pendingCollectionTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Name</th>
        <th>Type</th>
        <th>Pending</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- HISTORY -->
  <h4 style="margin-top:25px">Collection History</h4>
  <table id="collectionHistory">
    <thead>
      <tr>
        <th>Date</th>
        <th>Source</th>
        <th>Details</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="clearCollectionBtn"
          class="small-btn"
          style="background:#b71c1c;color:#fff;margin-top:10px">
    üóë Clear Collection History
  </button>
</section>

<!-- =============== LIBRARIES =============== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<!-- =============== AUTO SCRIPT LOADER =============== -->
<script>
  (function(){
    const v = Date.now();
    const js = [
      "/js/core.js",
      "/js/firebase.js",
      "/js/types.js",
      "/js/stock.js",
      "/js/sales.js",
      "/js/wanting.js",
      "/js/expenses.js",
      "/js/analytics.js",
      "/js/service.js",
      "/js/collection.js",
      "/js/security.js"
    ];
    js.forEach(f => {
      document.write(`<script src="${f}?v=${v}"><\/script>`);
    });
  })();
</script>

<!-- =============== TAB SWITCHER =============== -->
<script>
  function switchTab(id) {
    // Hide all sections
    qsa(".section").forEach(sec => sec.classList.remove("active"));
    // Show selected
    const target = qs("#" + id);
    if (target) target.classList.add("active");

    // Highlight tab
    qsa(".tab").forEach(t => t.classList.remove("active"));
    const tab = qs(`.tab[data-tab="${id}"]`);
    if (tab) tab.classList.add("active");

    // Refresh screens
    try { renderStock?.(); } catch {}
    try { renderSales?.(); } catch {}
    try { renderWanting?.(); } catch {}
    try { renderExpenses?.(); } catch {}
    try { renderServiceTables?.(); } catch {}
    try { renderCollection?.(); } catch {}
    try { renderAnalytics?.(); } catch {}
    try { updateSummaryCards?.(); } catch {}
  }

  document.addEventListener("click", e => {
    if (e.target.classList.contains("tab")) {
      switchTab(e.target.dataset.tab);
    }
  });
</script>

<!-- =============== CLOCK =============== -->
<script>
  function updateClock() {
    const d = new Date();
    const t = qs("#clockTime");
    const dt = qs("#clockDate");
    if (t) t.textContent = d.toLocaleTimeString();
    if (dt) dt.textContent = d.toLocaleDateString();
  }
  setInterval(updateClock, 1000);
  updateClock();
</script>

</body>
</html>

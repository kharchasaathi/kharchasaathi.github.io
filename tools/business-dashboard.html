<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ“¦ KharchaSaathi â€” Business Dashboard (v3.3)</title>
  <meta name="theme-color" content="#1e4bb8" />
  <link rel="icon" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/favicon.png" />

  <!-- CSS Files -->
  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/layout.css" />
  <link rel="stylesheet" href="/css/components.css" />
</head>

<body>

<script>
  const qs  = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
</script>

<!-- ğŸ” TOPBAR -->
<div class="topbar">
  <h1>ğŸ“¦ KharchaSaathi (Offline)</h1>

  <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
    <span id="emailTag">Loading...</span>

    <div class="simple-clock">
      <span id="clockTime" class="clock-line">--:--:--</span>
      <span id="clockDate" class="clock-line small">--</span>
    </div>

    <button id="themeBtn" class="theme-btn">ğŸŒ™</button>
    <a class="small-btn" href="/index.html">ğŸ  Back</a>
    <button id="logoutBtn" class="small-btn" style="background:#e53935;">
      ğŸ”“ Logout
    </button>
  </div>
</div>

<!-- ğŸ”¶ UNIVERSAL TOP METRICS BAR -->
<div id="universalBar">
  <div class="uni-row">

    <!-- NET PROFIT CARD -->
    <div class="uni-card main">
      <div class="uni-title">Net Profit (Sale + Service âˆ’ Expenses)</div>
      <div class="uni-value" id="unNetProfit">â‚¹0</div>
      <div class="uni-sub">
        <span>Sale:</span><span id="unSaleProfit" style="font-weight:600;">â‚¹0</span>
        <span>Service:</span><span id="unServiceProfit" style="font-weight:600;">â‚¹0</span>
        <span class="uni-exp-label">Exp:</span>
        <span id="unExpenses" class="uni-exp-value">â‚¹0</span>

        <!-- â­ Collect Button -->
        <button class="small-btn uni-collect-btn"
                data-collect="net"
                style="margin-left:auto;padding:4px 10px;font-size:11px;">
          Collect
        </button>
      </div>
    </div>

    <!-- STOCK INVESTMENT -->
    <div class="uni-card">
      <div class="uni-title">Stock Investment (Sold Items)</div>
      <div class="uni-value small" id="unStockInv">â‚¹0</div>
      <div class="uni-sub">
        <span class="uni-chip">Sold stock</span>

        <!-- â­ Collect Button -->
        <button class="small-btn uni-collect-btn"
                data-collect="stock"
                style="margin-left:auto;padding:4px 10px;font-size:11px;">
          Collect
        </button>
      </div>
    </div>

    <!-- SERVICE INVESTMENT -->
    <div class="uni-card">
      <div class="uni-title">Service Investment (Completed)</div>
      <div class="uni-value small" id="unServiceInv">â‚¹0</div>
      <div class="uni-sub">
        <span class="uni-chip">Closed jobs</span>

        <!-- â­ Collect Button -->
        <button class="small-btn uni-collect-btn"
                data-collect="service"
                style="margin-left:auto;padding:4px 10px;font-size:11px;">
          Collect
        </button>
      </div>
    </div>

    <!-- CREDIT (No collect button here) -->
    <div class="uni-card">
      <div class="uni-title">Pending Credit Sales</div>
      <div class="uni-value small" id="unCreditSales">â‚¹0</div>
      <div class="uni-sub">
        <span class="uni-chip">To be collected</span>
      </div>
    </div>

  </div>
</div>
<!-- =============== FIXED TAB ORDER =============== -->
<div class="tabs" role="tablist">
  <div class="tab active" data-tab="types">ğŸ“ Types</div>
  <div class="tab" data-tab="stock">ğŸ“¦ Stock</div>
  <div class="tab" data-tab="sales">ğŸ“ˆ Sales</div>
  <div class="tab" data-tab="wanting">ğŸ›’ Wanting</div>
  <div class="tab" data-tab="service">ğŸ›  Service</div>
  <div class="tab" data-tab="expenses">ğŸ’¸ Expenses</div>
  <div class="tab" data-tab="dashboard">ğŸ“Š Dashboard</div>
  <div class="tab" data-tab="collection">ğŸª™ Collection</div>
</div>

<!-- TYPES -->
<section id="types" class="section active">
  <h3>ğŸ—‚ Manage Item Types</h3>
  ...
</section>

<!-- STOCK -->
<section id="stock" class="section">
  <h3>ğŸ“¦ Current Stock</h3>
  ...
</section>

<!-- SALES -->
<section id="sales" class="section">
  <h3>ğŸ’° Sales & Profit</h3>
  ...
</section>

<!-- WANTING -->
<section id="wanting" class="section">
  <h3>ğŸ›’ Wanting List</h3>
  ...
</section>

<!-- SERVICE -->
<section id="service" class="section">
  <h3>ğŸ›  Service / Repair Manager</h3>
  ...
</section>

<!-- EXPENSES -->
<section id="expenses" class="section">
  <h3>ğŸ§¾ Expenses</h3>
  ...
</section>
<!-- DASHBOARD -->
<section id="dashboard" class="section">
  <h3>ğŸ“Š Dashboard (Today + Total)</h3>
  ...
</section>

<!-- COLLECTION -->
<section id="collection" class="section">
  <h3>ğŸª™ Collection Center</h3>
  ...
</section>
<!-- LIBRARIES -->
<script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<!-- AUTO SCRIPT LOADER -->
<script>
  (function(){
    const v = Date.now();
    const js = [
      "/js/core.js",
      "/js/firebase.js",
      "/js/types.js",
      "/js/stock.js",
      "/js/sales.js",
      "/js/wanting.js",
      "/js/expenses.js",
      "/js/analytics.js",
      "/js/service.js",
      "/js/collection.js",
      "/js/security.js",

      /* â­ NEW FILE */
      "/js/universal-bar.js"
    ];
    js.forEach(f => {
      document.write(`<script src="${f}?v=${v}"><\/script>`);
    });
  })();
</script>

<!-- TAB SWITCHER -->
<script>
  function switchTab(id) {
    qsa(".section").forEach(sec => sec.classList.remove("active"));
    qs("#" + id)?.classList.add("active");

    qsa(".tab").forEach(t => t.classList.remove("active"));
    qs(`.tab[data-tab="${id}"]`)?.classList.add("active");

    try { renderStock?.(); } catch {}
    try { renderSales?.(); } catch {}
    try { renderWanting?.(); } catch {}
    try { renderExpenses?.(); } catch {}
    try { renderServiceTables?.(); } catch {}
    try { renderCollection?.(); } catch {}
    try { renderAnalytics?.(); } catch {}
    try { updateSummaryCards?.(); } catch {}
    try { updateUniversalBar?.(); } catch {}
  }

  document.addEventListener("click", e => {
    if (e.target.classList.contains("tab")) {
      switchTab(e.target.dataset.tab);
    }
  });
</script>

<!-- CLOCK -->
<script>
  function updateClock() {
    const d = new Date();
    qs("#clockTime").textContent = d.toLocaleTimeString();
    qs("#clockDate").textContent = d.toLocaleDateString();
  }
  setInterval(updateClock, 1000);
  updateClock();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>

<style>
/* Dark Mode */
body.dark { background:#121212; color:#e8e8e8; }
body.dark .card { background:#1e1e1e; border-color:#555; }
body.dark input, body.dark select {
  background:#333; border-color:#666; color:#eee;
}
body.dark table, body.dark th, body.dark td {
  background:#222; border-color:#555; color:#eee;
}
body.dark .pill { background:#333; border-color:#777; color:#ffb84d; }
body.dark h1 { color:#ffd27f; }
body.dark .btn { background:#444; }
body.dark .btn:hover { background:#666; }
.theme-toggle {
  position:fixed; top:12px; right:12px;
  background:#ff8800; color:#fff; border:none;
  padding:8px 12px; border-radius:6px; font-size:14px; z-index:9999;
}
</style>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Trip Expense Splitter ‚Äî KharchaSaathi</title>

<style>
  :root{
    --bg:#FAFAFA; --card:#fff; --text:#222; --sub:#666;
    --brand:#ff7a00; --brand2:#cc6300; --line:#ddd;
  }

  body{
    font-family: Arial, sans-serif;
    background:var(--bg);
    margin:0;
    padding:22px;
    color:var(--text);
  }

  .wrap{ max-width:880px; margin:auto; }

  h1{
    font-size:32px;
    font-weight:800;
    text-align:center;
    margin:8px 0 14px;
  }

  .pill{
    display:inline-block;
    background:#fff2e6;
    border:1px solid #ffd6b0;
    color:#7a3f00;
    padding:6px 10px;
    border-radius:999px;
    font-size:13px;
  }

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    padding:16px;
    box-shadow:0 2px 8px rgba(0,0,0,.06);
  }

  input,select,button{
    padding:10px 12px;
    border:1px solid #ccc;
    border-radius:10px;
    font-size:15px;
  }

  button{ cursor:pointer; }

  .btn{
    background:var(--brand);
    color:#fff;
    border:none;
    font-weight:600;
    transition:0.25s;
  }
  .btn:hover{
    background:var(--brand2);
    transform:translateY(-2px);
  }

  .btn-ghost{
    background:#fff;
    border:1px solid #ccc;
    cursor:pointer;
    border-radius:10px;
  }

  .controls{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:10px;border:1px solid var(--line);text-align:left}
  th{background:#fafafa}
  .muted{color:var(--sub);font-size:13px}
  .mono{font-variant-numeric:tabular-nums}
  .flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .right{margin-left:auto}
</style>

</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()">üåô</button>

<div class="wrap">
  <h1>üöó Trip Expense Splitter <span class="pill">Smart Fair Split</span></h1>

  <div class="card">
    <div class="controls">
      <label class="flex">Currency
        <select id="currency">
          <option value="‚Çπ">‚Çπ INR</option>
          <option value="$">$ USD</option>
          <option value="‚Ç¨">‚Ç¨ EUR</option>
          <option value="¬£">¬£ GBP</option>
        </select>
      </label>
      <button class="btn right" onclick="addRow()">+ Add Member</button>
      <button class="btn-ghost" onclick="loadSample()">Demo data</button>
    </div>

    <div class="muted">Enter who paid how much ‚Äî system calculates final settlement.</div>

    <table id="tbl">
      <thead>
        <tr><th>Name</th><th>Amount paid</th><th>Actions</th></tr>
      </thead>
      <tbody id="rows"></tbody>
      <tfoot>
        <tr><th>Total</th><th colspan="2" class="mono" id="total">‚Äî</th></tr>
      </tfoot>
    </table>

    <div class="controls">
      <button class="btn" onclick="calculate()">Calculate settlements</button>
      <button class="btn-ghost" onclick="share()">Copy result</button>
      <button class="btn-ghost" onclick="resetAll()">Reset</button>
    </div>

    <div id="out" class="result"></div>
    <p class="muted">Balances minimize transfers ‚Üí fastest fair settlement.</p>
  </div>

  <p style="text-align:center;margin-top:18px">
    <a class="btn" href="../index.html">‚Üê Back to Home</a>
  </p>
</div>


<script>
const rowsEl=document.getElementById('rows'),totalEl=document.getElementById('total'),outEl=document.getElementById('out'),curEl=document.getElementById('currency');

function addRow(name='',paid=''){
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input placeholder="Name" value="${escapeHtml(name)}"></td>
  <td><input type="number" step="0.01" min="0" value="${paid}"></td>
  <td>
    <button class="btn-ghost" onclick="dupRow(this)">Duplicate</button>
    <button class="btn-ghost" onclick="delRow(this)">Delete</button>
  </td>`;
  rowsEl.appendChild(tr);
  recalcTotal();
}
function dupRow(btn){const tr=btn.closest('tr');const [n,a]=[...tr.querySelectorAll('input')].map(i=>i.value);addRow(n,a)}
function delRow(btn){btn.closest('tr').remove();recalcTotal()}
function recalcTotal(){totalEl.textContent=curEl.value+' '+[...rowsEl.querySelectorAll('tr')].reduce((s,tr)=>{const a=parseFloat(tr.querySelectorAll('input')[1]?.value||0);return s+(isFinite(a)?a:0)},0).toFixed(2)}
rowsEl.addEventListener('input',recalcTotal);curEl.addEventListener('change',recalcTotal)

function calculate(){
  const m=[...rowsEl.querySelectorAll('tr')].map(tr=>{const n=(tr.querySelectorAll('input')[0]?.value||'').trim()||'Friend',p=parseFloat(tr.querySelectorAll('input')[1]?.value||0);return{name:n,paid:isFinite(p)?p:0}}).filter(m=>m.name)
  if(!m.length){outEl.innerHTML=note('Add members.');return;}
  const t=m.reduce((s,x)=>s+x.paid,0),per=t/m.length;
  let owes=m.map(x=>({name:x.name,bal:+(x.paid-per).toFixed(2)})),neg=owes.filter(x=>x.bal<0).map(x=>({name:x.name,amt:-x.bal})),pos=owes.filter(x=>x.bal>0).map(x=>({name:x.name,amt:x.bal}));
  const x=[];let i=0,j=0;while(i<neg.length&&j<pos.length){const pay=Math.min(neg[i].amt,pos[j].amt);x.push({from:neg[i].name,to:pos[j].name,amt:pay});neg[i].amt-=pay;pos[j].amt-=pay;if(neg[i].amt<.01)i++;if(pos[j].amt<.01)j++}
  outEl.innerHTML=`<div class="card" style="margin-top:10px">
  <div class="flex"><div>Total:</div><b>${curEl.value} ${t.toFixed(2)}</b></div>
  <div class="flex"><div>People:</div><b>${m.length}</b></div>
  <div class="flex"><div>Per head:</div><b>${curEl.value} ${per.toFixed(2)}</b></div></div>
  <h3>Settlements</h3>
  <ul>${x.length?x.map(t=>`<li>${t.from} ‚Üí <b>${t.to}</b> : <b>${curEl.value} ${t.amt.toFixed(2)}</b></li>`).join(''):`<li>All balanced ‚úÖ</li>`}</ul>`;
}
function share(){navigator.clipboard.writeText(outEl.innerText.trim());alert('Copied ‚úÖ')}
function resetAll(){rowsEl.innerHTML='';outEl.innerHTML='';addRow();recalcTotal()}
function loadSample(){rowsEl.innerHTML='';[['Ravi',2000],['Kishore',500],['Abid',1500],['Imran',0]].forEach(([n,a])=>addRow(n,a));calculate()}
function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

/* Dark Mode Restore + Toggle */
(function(){const t=localStorage.getItem('ks-theme');if(t==='dark'){document.body.classList.add('dark');document.querySelector('.theme-toggle').textContent='‚òÄÔ∏è';}})();
function toggleTheme(){const d=document.body.classList.toggle('dark');localStorage.setItem('ks-theme',d?'dark':'light');document.querySelector('.theme-toggle').textContent=d?'‚òÄÔ∏è':'üåô'}
</script>

</body>
</html>

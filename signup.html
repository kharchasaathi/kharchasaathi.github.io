<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Create Account ‚Äî KharchaSaathi</title>

<style>
  body{
    margin:0;
    font-family:Poppins,Arial,sans-serif;
    background:#f2f2f2;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }

  .card{
    background:white;
    padding:28px;
    width:320px;
    border-radius:14px;
    box-shadow:0 6px 30px rgba(0,0,0,0.15);
    border:2px solid #ddd;
  }

  h2{
    margin:0 0 16px;
    color:#ff7a00;
    text-align:center;
  }

  input{
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:8px;
    border:1.8px solid #ccc;
    font-size:15px;
  }

  .pass-wrap{
    position:relative;
  }

  .pass-wrap .eye{
    position:absolute;
    right:12px;
    top:50%;
    transform:translateY(-50%);
    cursor:pointer;
    font-size:18px;
    color:#888;
  }

  button{
    width:100%;
    padding:10px;
    background:#28a745;
    color:white;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
    margin-top:10px;
  }

  button:hover{
    background:#1f8b39;
  }

  .login-link{
    margin-top:12px;
    font-size:14px;
    text-align:center;
  }

  .login-link a{
    color:#ff7a00;
    text-decoration:none;
  }

  #msg{
    text-align:center;
    color:#444;
    font-size:13px;
    margin-top:8px;
    min-height:18px;
  }
</style>
</head>

<body>

<div class="card">
  <h2>Create Account</h2>

  <input id="email" type="email" placeholder="Email">

  <div class="pass-wrap">
    <input id="password" type="password" placeholder="Password (min 6 chars)">
    <span class="eye" id="pwEye">üëÅÔ∏è</span>
  </div>

  <button id="signupBtn">Create Account</button>

  <div id="msg"></div>

  <div class="login-link">
    Already have an account? <a href="/login.html">Login</a>
  </div>
</div>

<!-- Firebase Core -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<!-- Firebase init -->
<script src="/js/firebase.js"></script>

<!-- login-utils.js (MANDATORY) -->
<script src="/js/login-utils.js"></script>

<script>
  const qs = s => document.querySelector(s);

  // Toggle eye icon
  qs("#pwEye").addEventListener("click", () => {
    const pw = qs("#password");
    pw.type = pw.type === "password" ? "text" : "password";
  });

  // SIGNUP BUTTON
  qs("#signupBtn").addEventListener("click", async () => {

    const email = qs("#email").value.trim();
    const pass  = qs("#password").value.trim();
    const msg   = qs("#msg");

    msg.textContent = "";

    if (!email || !pass) {
      msg.textContent = "Enter email & password.";
      return;
    }

    if (pass.length < 6) {
      msg.textContent = "Password must be at least 6 characters.";
      return;
    }

    qs("#signupBtn").disabled = true;
    qs("#signupBtn").textContent = "Please wait‚Ä¶";

    // Use login-utils.js
    const res = await signupUser(email, pass);

    if (res.success) {
      msg.style.color = "green";
      msg.textContent = "Account created successfully!";

      localStorage.setItem("ks-user-email", email);

      setTimeout(() => {
        window.location.href = "/tools/business-dashboard.html";
      }, 300);

    } else {
      msg.style.color = "red";
      msg.textContent = res.error.replace("Firebase:", "").trim();
      qs("#signupBtn").disabled = false;
      qs("#signupBtn").textContent = "Create Account";
    }
  });
</script>

</body>
</html>

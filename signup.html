<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Create Account ‚Äî KharchaSaathi</title>

<link rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">

<style>
  body{
    margin:0;
    padding:0;
    font-family:'Poppins',sans-serif;
    background:#eef2ff;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
  }

  .card{
    width:92%;
    max-width:380px;
    padding:28px;
    border-radius:16px;
    background:#fff;
    box-shadow:0 8px 30px rgba(0,0,0,0.10);
    border:1px solid #dbe1f0;
  }

  h2{
    margin:0 0 16px;
    text-align:center;
    font-weight:700;
    color:#2563eb;
    font-size:26px;
  }

  input{
    width:100%;
    padding:12px 14px;
    margin:10px 0;
    border-radius:10px;
    border:1px solid #c7cce1;
    font-size:15px;
  }
  input:focus{
    border-color:#2563eb;
    outline:none;
  }

  .pass-wrap{
    position:relative;
  }

  .eye{
    position:absolute;
    right:14px;
    top:50%;
    transform:translateY(-50%);
    font-size:18px;
    cursor:pointer;
    color:#666;
  }

  button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:12px;
    background:linear-gradient(135deg,#3b82f6,#2563eb);
    color:white;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    margin-top:6px;
    transition:.2s;
  }

  button:disabled{
    opacity:0.6;
    cursor:not-allowed;
  }

  button:hover:not(:disabled){
    transform:translateY(-2px);
  }

  #msg{
    margin-top:10px;
    min-height:18px;
    text-align:center;
    font-size:13px;
    color:#444;
  }

  .login-link{
    margin-top:14px;
    font-size:14px;
    text-align:center;
  }

  .login-link a{
    color:#2563eb;
    font-weight:600;
    text-decoration:none;
  }
</style>
</head>

<body>

<div class="card">
  <h2>Create Account</h2>

  <input id="email" type="email" placeholder="Email">

  <div class="pass-wrap">
    <input id="password" type="password" placeholder="Password (min 6 chars)">
    <span class="eye" id="pwEye">üëÅÔ∏è</span>
  </div>

  <button id="signupBtn">Create Account</button>

  <div id="msg"></div>

  <div class="login-link">
    Already have an account? <a href="/login.html">Login</a>
  </div>
</div>

<!-- Firebase compat scripts -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>

<!-- Firebase Init -->
<script src="/js/firebase.js"></script>

<!-- Auth Utils -->
<script src="/js/login-utils.js?v=20"></script>

<script>
/* =====================================================
   üîê LOGIN GUARD ‚Äî BLOCK SIGNUP WHEN LOGGED IN
===================================================== */
document.addEventListener("DOMContentLoaded", () => {
  setTimeout(() => {
    try {
      if (window.auth && window.auth.currentUser) {
        window.location.replace("/tools/business-dashboard.html");
      }
    } catch (e) {
      console.warn("Signup guard error:", e);
    }
  }, 200);
});
</script>

<script>
const qs = s => document.querySelector(s);

// Show / hide password
qs("#pwEye").addEventListener("click", () => {
  const pw = qs("#password");
  pw.type = pw.type === "password" ? "text" : "password";
});

// SIGNUP
qs("#signupBtn").addEventListener("click", async () => {

  const email = qs("#email").value.trim();
  const pass  = qs("#password").value.trim();
  const msg   = qs("#msg");
  const btn   = qs("#signupBtn");

  msg.textContent = "";

  if (!email || !pass){
    msg.style.color = "red";
    msg.textContent = "Enter email & password.";
    return;
  }

  if (pass.length < 6){
    msg.style.color = "red";
    msg.textContent = "Password must be at least 6 characters.";
    return;
  }

  btn.disabled = true;
  btn.textContent = "Creating‚Ä¶";

  const res = await signupUser(email, pass);

  if (res.success){
    msg.style.color = "green";
    msg.textContent = "Account created! Redirecting‚Ä¶";

    setTimeout(() => {
      window.location.href = "/tools/business-dashboard.html";
    }, 300);

  } else {
    msg.style.color = "red";
    msg.textContent = res.error;
    btn.disabled = false;
    btn.textContent = "Create Account";
  }
});
</script>

</body>
</html>
